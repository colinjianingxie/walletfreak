{% load humanize %}
    <!-- Loyalty Balances Section -->
    <section class="pc-section" id="balances-section">
        <div class="pc-section-header">
            <div>
                <h2 class="pc-section-title">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-coins" aria-hidden="true" style="color: #f59e0b;"><circle cx="8" cy="8" r="6"></circle><path d="M18.09 10.37A6 6 0 1 1 10.34 18"></path><path d="M7 6h1v4"></path><path d="m16.71 13.88.7.71-2.82 2.82"></path></svg>
                    Loyalty Balances
                </h2>
                <p class="pc-section-subtitle">Est. Value: <span style="color: #16a34a; font-weight: 700;">${{ total_est_value|floatformat:2 }}</span></p>
            </div>
            <button id="toggle-edit-btn" class="btn-secondary" onclick="toggleEditMode()">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-pen" aria-hidden="true"><path d="M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z"></path></svg>
                Update Balances
            </button>
        </div>

        <div class="pc-balances-grid">
            {% for program in display_programs %}
            <div class="pc-balance-card group" data-program-id="{{ program.program_id }}">
                <div style="display: flex; align-items: center; gap: 1rem; flex: 1;">
                    {% if program.logo_url %}
                        <div class="pc-balance-icon" style="background-image: url('{{ program.logo_url }}');"></div>
                    {% else %}
                        <div class="pc-balance-icon fallback">
                            {{ program.name|slice:":2"|upper }}
                        </div>
                    {% endif %}
                    
                    <div class="pc-balance-info">
                        <div class="label">{{ program.name }}</div>
                        <input type="text" class="value balance-input" value="{{ program.balance|floatformat:0|intcomma|default:'0' }}" readonly data-original="{{ program.balance|floatformat:0|default:'0' }}" onblur="saveBalance('{{ program.program_id }}', this)">
                    </div>
                </div>
            </div>
            {% endfor %}

            <!-- Add Program -->
            <button class="btn-add-program">
                <div class="add-program-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-plus" aria-hidden="true"><path d="M5 12h14"></path><path d="M12 5v14"></path></svg>
                </div>
                <span class="add-program-text">Add Program</span>
            </button>
        </div>
    </section>
