{% extends 'base.html' %}
{% load static %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/blog_detail.css' %}">
{% endblock %}

{% block main_style %}background: #F8F9FA; min-height: 100vh; padding: 0;{% endblock %}

{% block full_width_content %}
<div class="blog-detail-container">
    <!-- Header Navigation -->
    <div class="detail-header">
        <div class="container">
            <div class="header-nav">
                <a href="{% url 'blog_list' %}" class="back-btn">
                    <span class="material-icons">arrow_back</span>
                    <span>Back to Feed</span>
                </a>
                
                <div class="header-actions">
                    <button class="action-btn bookmark-btn">
                        <span class="material-icons">bookmark_border</span>
                    </button>
                    <button class="action-btn share-btn">
                        <span class="material-icons">share</span>
                    </button>
                    {% if is_editor %}
                    <a href="{% url 'blog_edit' blog.slug %}" class="action-btn edit-btn">
                        <span class="material-icons">edit</span>
                    </a>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>

    <!-- Post Content -->
    <div class="container">
        <article class="post-detail">
            <!-- Post Category -->
            <div class="post-category-badge">
                {% if 'review' in blog.tags|lower %}REVIEWS
                {% elif 'guide' in blog.tags|lower %}GUIDES
                {% elif 'tips' in blog.tags|lower %}TIPS
                {% elif 'news' in blog.tags|lower %}NEWS
                {% else %}REVIEWS{% endif %}
            </div>

            <!-- Featured Image -->
            {% if blog.featured_image %}
            <div class="featured-image">
                <img src="{{ blog.featured_image }}" alt="{{ blog.title }}">
            </div>
            {% endif %}

            <!-- Post Header -->
            <div class="post-header">
                <h1 class="post-title">{{ blog.title }}</h1>
                
                <div class="post-meta">
                    <div class="author-info">
                        <div class="author-avatar">
                            <span class="material-icons">person</span>
                        </div>
                        <div class="author-details">
                            <span class="author-name">{{ blog.author_name }}</span>
                            <span class="author-handle">@{{ blog.author_name|lower|cut:" " }}</span>
                        </div>
                    </div>
                    
                    <div class="post-stats">
                        <div class="stat-item">
                            <span class="material-icons">schedule</span>
                            <span>{{ blog.published_at|timesince }} ago</span>
                        </div>
                        <div class="stat-item">
                            <span class="material-icons">trending_up</span>
                            <span>1.4k Score</span>
                        </div>
                        <div class="stat-item">
                            <span class="material-icons">access_time</span>
                            <span>5 min read</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- TL;DR Section -->
            {% if blog.excerpt %}
            <div class="tldr-section">
                <div class="tldr-header">
                    <span class="material-icons">bolt</span>
                    <span class="tldr-label">TOO LONG; DIDN'T READ</span>
                </div>
                <div class="tldr-content">
                    {{ blog.excerpt }}
                </div>
            </div>
            {% endif %}

            <!-- Post Content -->
            <div class="post-content">
                {{ blog.html_content }}
            </div>

            <!-- Post Actions Footer -->
            <div class="post-actions-footer">
                <div class="action-group">
                    <button class="action-btn upvote-btn">
                        <span class="material-icons">trending_up</span>
                        <span class="action-count">1.4k</span>
                    </button>
                    <button class="action-btn comment-btn">
                        <span class="material-icons">chat_bubble_outline</span>
                        <span class="action-count">89</span>
                    </button>
                    <button class="action-btn share-btn">
                        <span class="material-icons">share</span>
                        <span class="action-text">Share</span>
                    </button>
                </div>
                <button class="action-btn save-btn">
                    <span class="material-icons">bookmark_border</span>
                    <span class="action-text">Save</span>
                </button>
            </div>
        </article>

        <!-- Related Posts or Comments Section -->
        <div class="related-section">
            <h3>Continue Reading</h3>
            <p>More posts from The Ledger community coming soon...</p>
        </div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Bookmark functionality
    document.querySelectorAll('.bookmark-btn, .save-btn').forEach(btn => {
        btn.addEventListener('click', function() {
            this.classList.toggle('active');
            const icon = this.querySelector('.material-icons');
            if (icon.textContent === 'bookmark_border') {
                icon.textContent = 'bookmark';
            } else if (icon.textContent === 'bookmark') {
                icon.textContent = 'bookmark_border';
            }
        });
    });

    // Share functionality
    document.querySelectorAll('.share-btn').forEach(btn => {
        btn.addEventListener('click', function() {
            if (navigator.share) {
                navigator.share({
                    title: document.title,
                    url: window.location.href
                });
            } else {
                navigator.clipboard.writeText(window.location.href);
                const originalText = this.querySelector('.action-text');
                if (originalText) {
                    const original = originalText.textContent;
                    originalText.textContent = 'Copied!';
                    setTimeout(() => {
                        originalText.textContent = original;
                    }, 2000);
                }
            }
        });
    });

    // Upvote functionality
    document.querySelectorAll('.upvote-btn').forEach(btn => {
        btn.addEventListener('click', function() {
            this.classList.toggle('active');
            const count = this.querySelector('.action-count');
            if (count) {
                const currentCount = parseFloat(count.textContent);
                if (this.classList.contains('active')) {
                    count.textContent = (currentCount + 0.1).toFixed(1) + 'k';
                } else {
                    count.textContent = (currentCount - 0.1).toFixed(1) + 'k';
                }
            }
        });
    });
});
</script>
{% endblock %}