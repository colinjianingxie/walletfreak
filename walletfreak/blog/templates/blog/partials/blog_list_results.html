{% load static %}
<!-- Loading Indicator Overlay (Restored on swap) -->
<div class="blog-loading-overlay htmx-indicator">
    <div class="loading-spinner"></div>
</div>

{% if blogs %}
<div class="blog-grid" id="blog-grid">
    {% for blog in blogs %}
    <a href="{% url 'blog_detail' slug=blog.slug %}" class="blog-card-link">
        <article class="blog-card group">
            <!-- Vote Column (Desktop) -->
            <div class="vote-col">
                <button class="vote-btn">
                    <span class="material-icons" style="font-size: 24px;">local_fire_department</span>
                </button>
                <span class="vote-count">{{ blog.upvote_count|default:0 }}</span>
            </div>

            <!-- Main Content -->
            <div class="blog-content-area">
                <!-- Meta Header -->
                <div class="meta-row">
                    {% if blog.vendor %}
                    <span class="vendor-badge {% if blog.is_premium %}premium{% else %}default{% endif %}">
                        {% if blog.is_premium %}
                        <span class="material-icons" style="font-size: 10px;">emoji_events</span>
                        {% endif %}
                        {{ blog.vendor|upper }}
                    </span>
                    <span class="meta-divider">•</span>
                    {% elif blog.tags and blog.tags|length > 0 %}
                    <span class="vendor-badge default">
                        {{ blog.tags.0|upper }}
                    </span>
                    <span class="meta-divider">•</span>
                    {% endif %}
                    <span class="meta-time">
                        {% if blog.published_at %}
                            {{ blog.published_at|timesince }} ago
                        {% else %}
                            Draft
                        {% endif %}
                    </span>
                </div>

                <div class="content-layout">
                    <!-- Text Content -->
                    <div class="text-content">
                        <h2 class="blog-title">{{ blog.title }}</h2>
                        
                        {% if not blog.is_premium or is_authenticated or is_editor %}
                        <p class="blog-excerpt">{{ blog.excerpt|default:blog.content|striptags|truncatewords:25 }}</p>
                        {% endif %}

                        <div class="stats-row">
                            <div class="stat-item">
                                <span class="material-icons" style="font-size: 14px;">chat_bubble_outline</span>
                                {{ blog.comment_count|default:0 }}
                            </div>
                            <div class="stat-item">
                                <span class="material-icons" style="font-size: 14px;">schedule</span>
                                {{ blog.read_time|default:'Medium'|title }}
                            </div>
                            
                            <!-- Share Button -->
                            <button class="share-btn" onclick="event.preventDefault(); navigator.share({title: '{{ blog.title|escapejs }}', url: window.location.origin + '{% url 'blog_detail' slug=blog.slug %}'})">
                                <span class="material-icons" style="font-size: 16px;">share</span>
                            </button>

                            <!-- Bookmark Button -->
                            <button class="bookmark-btn" onclick="toggleBlogBookmark(event, '{{ blog.slug }}', this)" 
                                    style="background: none; border: none; cursor: pointer; color: {% if blog.id in user_saved_posts %}var(--primary){% else %}#94A3B8{% endif %}; display: flex; align-items: center; justify-content: center; padding: 0.25rem;">
                                <span class="material-icons" style="font-size: 18px;">{% if blog.id in user_saved_posts %}bookmark{% else %}bookmark_border{% endif %}</span>
                            </button>

                            <div class="read-intel-btn">
                                READ POST
                                <span class="material-icons" style="font-size: 14px;">arrow_forward</span>
                            </div>
                        </div>
                    </div>

                    <!-- Image -->
                    <div class="card-image-wrapper">
                        {% if blog.featured_image %}
                        <img src="{{ blog.featured_image }}" 
                             alt="{{ blog.title }}" 
                             class="card-image {% if blog.is_premium and not is_authenticated and not is_editor %}premium-blur{% endif %}" 
                             loading="lazy">
                        {% else %}
                        <div class="blog-image-placeholder"></div>
                        {% endif %}

                        {% if blog.is_premium and not is_authenticated and not is_editor %}
                        <div class="premium-lock-badge">
                            <div class="lock-badge-inner">
                                <span class="material-icons" style="color: #F59E0B;">lock</span>
                            </div>
                        </div>
                        {% endif %}
                    </div>
                </div>
            </div>
        </article>
    </a>
    {% endfor %}
</div>
{% else %}
<div class="empty-state">
    <div class="empty-icon-wrapper">
        <span class="material-icons empty-icon">search_off</span>
    </div>
    <h3 class="empty-title">No matching updates</h3>
    <p class="empty-text">We couldn't find any posts matching your criteria.</p>
</div>
{% endif %}

{% if request.headers.HX_Request %}
<div id="blog-sidebar" hx-swap-oob="true">
    {% include "blog/partials/sidebar.html" %}
</div>

<div id="active-filters-bar" hx-swap-oob="true">
    {% include "blog/partials/active_filters.html" %}
</div>

<div id="mobile-active-filters" hx-swap-oob="true">
    {% include "blog/partials/active_filters.html" %}
</div>

<div id="mobile-quick-chips" hx-swap-oob="true">
    {% include "blog/partials/mobile_quick_chips.html" %}
</div>

<div id="mobile-filter-modal-container" hx-swap-oob="innerHTML">
    {% include "blog/partials/mobile_filter_modal.html" %}
</div>
{% endif %}
