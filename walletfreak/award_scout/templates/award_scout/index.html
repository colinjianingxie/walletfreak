{% extends "base.html" %}
{% load static %}

{% block breadcrumb_section %}Tools{% endblock %}
{% block page_title %}Award Scout{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'award_scout/css/styles.css' %}">
{% endblock %}

{% block content %}
<div class="as-page-container">
    <div class="as-content-wrapper">
        
        <!-- Header Section -->
        <div class="as-header-section">
            <div class="as-header-content">
                <div class="as-badge">
                    <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-radar"><path d="M19.07 4.93A10 10 0 0 0 6.99 3.34"></path><path d="M4 6h.01"></path><path d="M2.29 9.62A10 10 0 1 0 21.31 8.35"></path><path d="M16.24 7.76A6 6 0 1 0 8.23 16.67"></path><path d="M12 18h.01"></path><path d="M17.99 11.66A6 6 0 0 1 15.77 16.67"></path><circle cx="12" cy="12" r="2"></circle><path d="m13.41 10.59 5.66-5.66"></path></svg> 
                    Award Scout
                </div>
                <h1 class="as-main-title">Find availability. Get alerted.</h1>
                <p class="as-subtitle">Paste a Hyatt search URL below. We'll extract the properties and dates to start monitoring for award space automatically.</p>
            </div>

            <!-- Search Form -->
            <div class="as-search-container">
                <form class="as-search-form" method="POST" action="{% url 'award_scout:index' %}" onsubmit="this.querySelector('button[type=submit]').classList.add('loading');">
                    {% csrf_token %}
                    <div class="as-glow-effect"></div>
                    <div class="as-input-wrapper">
                        <div class="as-input-icon">
                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-globe"><circle cx="12" cy="12" r="10"></circle><path d="M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20"></path><path d="M2 12h20"></path></svg>
                        </div>
                        <input required name="url" placeholder="Paste URL (e.g., https://www.hyatt.com/search/hotels/...)" class="as-search-input" type="url" value="{{ search_url|default:'' }}">
                        <div class="as-form-actions">
                            <button type="button" class="as-btn-icon" title="Notification Settings">
                                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-mail"><path d="m22 7-8.991 5.727a2 2 0 0 1-2.009 0L2 7"></path><rect x="2" y="4" width="20" height="16" rx="2"></rect></svg>
                            </button>
                            <button type="submit" class="as-btn-primary">
                                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-loader as-loader"><path d="M12 2v4"></path><path d="m16.2 7.8 2.9-2.9"></path><path d="M18 12h4"></path><path d="m16.2 16.2 2.9 2.9"></path><path d="M12 18v4"></path><path d="m4.9 19.1 2.9-2.9"></path><path d="M2 12h4"></path><path d="m4.9 4.9 2.9 2.9"></path></svg>
                                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-search as-btn-text"><path d="m21 21-4.34-4.34"></path><circle cx="11" cy="11" r="8"></circle></svg>
                                <span class="hidden-sm as-btn-text">Scan URL</span>
                            </button>
                        </div>
                    </div>
                </form>
            </div>
        </div>

        {% if error_message %}
        <div class="as-error-message">
            {{ error_message }}
        </div>
        {% endif %}

        {% if scan_active and found_hotels %}
        <!-- Selection UI -->
        <div class="as-selection-container">
            <form method="POST" action="{% url 'award_scout:track' %}">
                {% csrf_token %}
                <div class="as-selection-card">
                    <div class="as-selection-header">
                        <div class="as-selection-title-group">
                            <div class="as-icon-box-success">
                                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-circle-check-big"><path d="M21.801 10A10 10 0 1 1 17 3.335"></path><path d="m9 11 3 3L22 4"></path></svg>
                            </div>
                            <div>
                                <h3 class="as-selection-title">Found Hotels in Search</h3>
                                <p class="as-selection-subtitle">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-calendar"><path d="M8 2v4"></path><path d="M16 2v4"></path><rect width="18" height="18" x="3" y="4" rx="2"></rect><path d="M3 10h18"></path></svg> 
                                    2026-01-29 — 2026-01-30
                                </p>
                            </div>
                        </div>
                        <div class="as-selection-actions">
                            <a href="{% url 'award_scout:index' %}" class="as-btn-cancel">Cancel</a>
                            <button type="submit" class="as-btn-success">
                                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-plus"><path d="M5 12h14"></path><path d="M12 5v14"></path></svg> 
                                Track Selected
                            </button>
                        </div>
                    </div>
                    
                    <div class="as-selection-content">
                        <p class="text-sm font-bold text-slate-400 uppercase tracking-wider mb-4">Select properties to monitor</p>
                        <div class="as-selection-grid">
                            {% for hotel in found_hotels %}
                            <label class="as-property-card">
                                <input type="checkbox" name="selected_hotels" value="{{ hotel.id }}">
                                <div class="as-property-top">
                                    <div class="as-checkbox-circle">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-check"><path d="M20 6 9 17l-5-5"></path></svg>
                                    </div>
                                    <span class="as-property-price">{{ hotel.price }}</span>
                                </div>
                                <h4 class="as-property-name">{{ hotel.name }}</h4>
                                <span class="as-property-brand">{{ hotel.brand }}</span>
                            </label>
                            {% endfor %}
                        </div>
                    </div>
                </div>
            </form>
        </div>
        {% endif %}

        <!-- Active Scouts Result Section -->
        <div class="as-results-section">
            <div class="as-section-header">
                <h2 class="as-section-title">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-radar text-blue-500"><path d="M19.07 4.93A10 10 0 0 0 6.99 3.34"></path><path d="M4 6h.01"></path><path d="M2.29 9.62A10 10 0 1 0 21.31 8.35"></path><path d="M16.24 7.76A6 6 0 1 0 8.23 16.67"></path><path d="M12 18h.01"></path><path d="M17.99 11.66A6 6 0 0 1 15.77 16.67"></path><circle cx="12" cy="12" r="2"></circle><path d="m13.41 10.59 5.66-5.66"></path></svg> 
                    Active Scouts
                    <span class="as-count-badge">{{ active_count }} / {{ limit }}</span>
                </h2>
            </div>

            <div class="as-grid">
                {% if active_alerts %}
                    {% for alert in active_alerts %}
                    <div class="as-card group">
                        <div class="as-card-top">
                            <div class="as-card-info">
                                <div class="as-card-status">
                                    <span class="as-status-label as-status-live">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="10" height="10" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-loader animate-spin"><path d="M12 2v4"></path><path d="m16.2 7.8 2.9-2.9"></path><path d="M18 12h4"></path><path d="m16.2 16.2 2.9 2.9"></path><path d="M12 18v4"></path><path d="m4.9 19.1 2.9-2.9"></path><path d="M2 12h4"></path><path d="m4.9 4.9 2.9 2.9"></path></svg> 
                                        Live
                                    </span>
                                </div>
                                <h3 class="as-hotel-name" title="{{ alert.hotel_name }}">{{ alert.hotel_name }}</h3>
                            </div>
                            <div class="as-card-actions">
                                <a href="{{ alert.url }}" target="_blank" rel="noreferrer" class="as-action-link">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-external-link"><path d="M15 3h6v6"></path><path d="M10 14 21 3"></path><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path></svg>
                                </a>
                                <button class="as-action-delete">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-trash2"><path d="M10 11v6"></path><path d="M14 11v6"></path><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6"></path><path d="M3 6h18"></path><path d="M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path></svg>
                                </button>
                            </div>
                        </div>

                        <div class="as-card-meta">
                            <span class="as-meta-item">
                                <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-calendar"><path d="M8 2v4"></path><path d="M16 2v4"></path><rect width="18" height="18" x="3" y="4" rx="2"></rect><path d="M3 10h18"></path></svg> 
                                2024-11-15 — 2024-11-20
                            </span>
                            <span class="as-meta-item">
                                <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-clock"><path d="M12 6v6l4 2"></path><circle cx="12" cy="12" r="10"></circle></svg> 
                                2 mins ago
                            </span>
                        </div>
                        
                        <div class="as-card-footer">
                            <div class="as-notify-text">Notify: <span class="text-dark">{{ request.user.username|truncatechars:10 }}</span></div>
                            <button class="as-pause-btn">Pause</button>
                        </div>
                    </div>
                    {% endfor %}
                {% else %}
                    <!-- Empty State / Placeholder if needed -->
                    <div class="text-center p-8 border border-dashed border-slate-300 rounded-xl" style="grid-column: span 2;">
                        <p class="text-slate-400">No active scouts. Paste a URL above to start.</p>
                    </div>
                {% endif %}
            </div>
        </div>

    </div>
</div>
{% endblock %}
