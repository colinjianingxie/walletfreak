{% extends 'base.html' %}
{% load static %}

{% block main_style %}padding: 0; background: #F7F7F7; min-height: calc(100vh - 70px);{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/personality_list.css' %}">
{% endblock %}

{% block content %}

<!-- Personalities Header with Quiz -->
<section style="background: linear-gradient(135deg, #1E293B 0%, #0F172A 100%); padding: 4rem 0; text-align: center; color: white; position: relative; overflow: hidden; border-radius: 0 0 40px 40px; margin-left: calc(-50vw + 50%); margin-right: calc(-50vw + 50%); width: 100vw;">
    <!-- Background decoration -->
    <div style="position: absolute; top: -100px; right: -100px; width: 300px; height: 300px; background: rgba(124, 58, 237, 0.1); border-radius: 50%; filter: blur(80px);"></div>
    <div style="position: absolute; bottom: -100px; left: -100px; width: 300px; height: 300px; background: rgba(99, 102, 241, 0.1); border-radius: 50%; filter: blur(80px);"></div>
    
    <div style="position: relative; z-index: 1; max-width: 1400px; margin: 0 auto; padding: 0 1rem;">
        <!-- Badge -->
        <div style="display: inline-flex; align-items: center; gap: 0.5rem; background: rgba(255,255,255,0.1); padding: 0.5rem 1rem; border-radius: 999px; margin-bottom: 1.5rem; backdrop-filter: blur(10px); border: 1px solid rgba(255,255,255,0.1);">
            <span style="font-size: 1.1rem;"><span class="material-icons" style="font-size: 16px; vertical-align: middle;">auto_awesome</span></span>
            <span style="font-size: 0.75rem; font-weight: 600; letter-spacing: 0.1em;">Discover Your Financial DNA</span>
        </div>
        
        <!-- Title -->
        <h1 style="font-size: clamp(2.5rem, 5vw, 3.5rem); font-weight: 700; margin-bottom: 1rem; line-height: 1.2; color: white;">
            What's your <span style="background: linear-gradient(135deg, #A78BFA 0%, #C084FC 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;">Wallet Vibe?</span>
        </h1>
        
        <!-- Subtitle (hidden during quiz, shown on initial load) -->
        <p id="quiz-subtitle-text" style="font-size: 1.125rem; color: #94A3B8; max-width: 600px; margin: 0 auto 3rem;">
            Answer a few quick questions to discover your perfect credit card personality.
        </p>

        <!-- Quiz Container -->
        <div id="quiz-container" style="max-width: 950px; margin: 0 auto; background: rgba(30, 41, 59, 0.6); backdrop-filter: blur(20px); border-radius: 20px; padding: 2.5rem 3rem; border: 1px solid rgba(255,255,255,0.1); box-shadow: 0 20px 40px rgba(0,0,0,0.3);">
            <!-- Progress Header -->
            <div style="margin-bottom: 1.5rem;">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                    <span id="question-counter" style="font-size: 0.75rem; font-weight: 700; letter-spacing: 0.1em; color: #94A3B8;">QUESTION 1 OF 4</span>
                    <span id="progress-percent" style="font-size: 0.75rem; font-weight: 700; letter-spacing: 0.1em; color: #94A3B8;">0% COMPLETE</span>
                </div>
                <!-- Progress Bar -->
                <div style="width: 100%; height: 8px; background: rgba(255,255,255,0.1); border-radius: 999px; overflow: hidden;">
                    <div id="progress-bar" style="width: 0%; height: 100%; background: linear-gradient(90deg, #3B82F6 0%, #8B5CF6 100%); border-radius: 999px; transition: width 0.5s ease;"></div>
                </div>
            </div>

            <!-- Question Text -->
            <h2 id="question-text" style="font-size: 1.5rem; font-weight: 600; margin-bottom: 0.75rem; color: white; line-height: 1.3;"></h2>
            <p id="question-subtitle" style="font-size: 0.9rem; color: #94A3B8; margin-bottom: 1.75rem;"></p>

            <!-- Options Container -->
            <div id="options-container" style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 0.875rem; margin-bottom: 1.75rem;">
                <!-- Options will be dynamically inserted here -->
            </div>

            <!-- Navigation Buttons -->
            <div style="display: flex; gap: 1rem; justify-content: center; align-items: center;">
                <button id="back-btn" style="display: none; padding: 0.875rem 1.5rem; background: rgba(100, 116, 139, 0.3); color: white; border: 1px solid rgba(255,255,255,0.2); border-radius: 10px; font-weight: 600; cursor: pointer; transition: all 0.3s; font-size: 1rem;" onclick="previousQuestion()">
                    ‚Üê Back
                </button>
                <button id="continue-btn" style="display: none; padding: 0.875rem 2rem; background: white; color: #1E293B; border: none; border-radius: 10px; font-weight: 700; cursor: pointer; transition: all 0.3s; box-shadow: 0 4px 12px rgba(0,0,0,0.2); font-size: 1rem;" onclick="nextQuestion()">
                    Continue ‚Üí
                </button>
            </div>
        </div>

        <!-- Loading Container (hidden initially) -->
        <div id="loading-container" style="display: none; max-width: 950px; margin: 0 auto; background: rgba(30, 41, 59, 0.6); backdrop-filter: blur(20px); border-radius: 20px; padding: 4rem 3rem; border: 1px solid rgba(255,255,255,0.1); box-shadow: 0 20px 40px rgba(0,0,0,0.3); text-align: center;">
            <!-- Spinner -->
            <div style="margin: 0 auto 2rem; width: 80px; height: 80px; border: 4px solid rgba(139, 92, 246, 0.2); border-top: 4px solid #8B5CF6; border-radius: 50%; animation: spin 1s linear infinite;"></div>
            
            <h2 id="loading-title" style="font-size: 1.75rem; font-weight: 600; margin-bottom: 1rem; color: white;">Analyzing your preferences...</h2>
            <p id="loading-subtitle" style="font-size: 1rem; color: #94A3B8;">Crunching the multipliers</p>
        </div>

        <!-- Results Container (hidden initially) -->
        <div id="results-container" style="display: none; max-width: 950px; margin: 0 auto; background: rgba(30, 41, 59, 0.6); backdrop-filter: blur(20px); border-radius: 20px; padding: 3.5rem 3rem; border: 1px solid rgba(255,255,255,0.1); box-shadow: 0 20px 40px rgba(0,0,0,0.3); text-align: center;">
            <p style="font-size: 0.75rem; font-weight: 700; letter-spacing: 0.1em; color: #94A3B8; margin-bottom: 2rem;">YOUR VIBE IS</p>
            
            <!-- Personality Avatar -->
            <div style="margin: 0 auto 2rem; width: 160px; height: 160px; background: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; box-shadow: 0 0 0 12px rgba(168, 85, 247, 0.2), 0 0 60px rgba(168, 85, 247, 0.4); position: relative;">
                <img id="result-image" src="" alt="Personality" style="width: 70%; height: 70%; object-fit: contain;">
                <!-- Glow effect -->
                <div style="position: absolute; inset: -20px; background: radial-gradient(circle, rgba(168, 85, 247, 0.4) 0%, transparent 70%); filter: blur(20px); z-index: -1;"></div>
            </div>

            <h2 id="result-name" style="font-size: 2.5rem; font-weight: 700; margin-bottom: 1.5rem; color: white;"></h2>
            <p id="result-description" style="font-size: 1.125rem; color: #CBD5E1; max-width: 600px; margin: 0 auto 3rem; line-height: 1.6;"></p>

            <!-- Action Buttons -->
            <div style="display: flex; gap: 1rem; justify-content: center; flex-wrap: wrap;">
                <a id="view-stack-btn" href="#" style="padding: 1rem 2rem; background: linear-gradient(135deg, #3B82F6 0%, #2563EB 100%); color: white; border: none; border-radius: 12px; font-weight: 700; text-decoration: none; display: inline-flex; align-items: center; gap: 0.5rem; transition: all 0.3s; box-shadow: 0 8px 20px rgba(59, 130, 246, 0.4);">
                    View Your Stack
                </a>
                <button onclick="resetQuiz()" style="padding: 1rem 2rem; background: rgba(100, 116, 139, 0.3); color: white; border: 1px solid rgba(255,255,255,0.2); border-radius: 12px; font-weight: 700; cursor: pointer; display: inline-flex; align-items: center; gap: 0.5rem; transition: all 0.3s;">
                    <span class="material-icons" style="font-size: 18px;">refresh</span>
                    Start Over
                </button>
            </div>
        </div>
    </div>
</section>

<!-- User's Assigned Personality (if exists) -->
{% if assigned_personality %}
<section class="container" style="padding: 2rem 0 1rem;">
    <div style="background: linear-gradient(135deg, #F5F3FF 0%, #EDE9FE 100%); border-radius: 20px; padding: 2rem; border: 1px solid #E9D5FF; box-shadow: 0 4px 12px rgba(168, 85, 247, 0.15);">
        <div style="display: grid; grid-template-columns: auto 1fr auto; gap: 2rem; align-items: center;">
            <!-- Left: Icon -->
            <div style="width: 80px; height: 80px; background: linear-gradient(135deg, #A855F7 0%, #9333EA 100%); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 2.5rem; box-shadow: 0 8px 16px rgba(168, 85, 247, 0.3);">
                {{ assigned_personality.icon|default:"üéØ" }}
            </div>

            <!-- Middle: Info -->
            <div>
                <div style="font-size: 0.75rem; color: #7C3AED; font-weight: 700; letter-spacing: 0.1em; margin-bottom: 0.5rem; text-transform: uppercase;">
                    YOUR PERSONALITY
                </div>
                
                <h3 style="font-size: 1.75rem; font-weight: 800; margin: 0 0 0.5rem 0; color: #1F2937;">
                    {{ assigned_personality.name }}
                </h3>

                <p style="color: #64748B; line-height: 1.6; margin: 0; font-size: 0.9375rem; max-width: 600px;">
                    {{ assigned_personality.tagline }}
                </p>
            </div>

            <!-- Right: Action -->
            <a href="{% url 'personality_results' %}" style="padding: 1rem 1.5rem; background: white; color: #7C3AED; border: 2px solid #A855F7; border-radius: 12px; font-weight: 700; text-decoration: none; display: flex; align-items: center; gap: 0.5rem; transition: all 0.2s; white-space: nowrap;">
                View Details
                <span class="material-icons" style="font-size: 18px;">arrow_forward</span>
            </a>
        </div>
    </div>
</section>
{% endif %}

<!-- Personalities Grid -->
<section style="background: #F9FAFB; padding: 4rem 0;">
    <div class="container">
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(320px, 1fr)); gap: 2rem; max-width: 1400px; margin: 0 auto;" id="personalities-grid">
            {% for personality in personalities %}
            <div class="personality-card-link" data-name="{{ personality.name|lower }}"
                data-desc="{{ personality.description|lower }}" data-tag="{{ personality.tagline|default:''|lower }}"
                style="background: white; border-radius: 20px; padding: 2.5rem; border: 1px solid #E5E7EB; box-shadow: 0 2px 8px rgba(0,0,0,0.04); transition: all 0.3s; display: flex; flex-direction: column; align-items: center; text-align: center;">
                
                <!-- Avatar Icon -->
                <div style="width: 120px; height: 120px; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin-bottom: 1.5rem; box-shadow: 0 0 0 1px rgba(59, 130, 246, 0.1), 0 0 30px rgba(59, 130, 246, 0.15), 0 8px 20px rgba(0,0,0,0.08);">
                    <img src="{% static 'images/personalities/'|add:personality.slug|add:'.png' %}" alt="{{ personality.name }}" style="width: 70%; height: 70%; object-fit: contain;">
                </div>

                <!-- Personality Name -->
                <h3 style="font-size: 1.5rem; font-weight: 700; margin: 0 0 1rem 0; color: #1F2937;">
                    {{ personality.name }}
                </h3>

                <!-- Description -->
                <p style="color: #64748B; line-height: 1.6; margin: 0 0 1.5rem 0; font-size: 0.9375rem; flex-grow: 1;">
                    {{ personality.description|truncatewords:20 }}
                </p>

                <!-- Tags -->
                <div style="display: flex; gap: 0.5rem; flex-wrap: wrap; justify-content: center; margin-bottom: 1.5rem;">
                    {% if 'jetsetter' in personality.id|lower %}
                    <span style="background: #EEF2FF; color: #6366F1; font-size: 0.7rem; font-weight: 600; padding: 0.375rem 0.75rem; border-radius: 6px; text-transform: uppercase; letter-spacing: 0.05em;">#TRAVEL</span>
                    <span style="background: #EEF2FF; color: #6366F1; font-size: 0.7rem; font-weight: 600; padding: 0.375rem 0.75rem; border-radius: 6px; text-transform: uppercase; letter-spacing: 0.05em;">#FLY</span>
                    <span style="background: #EEF2FF; color: #6366F1; font-size: 0.7rem; font-weight: 600; padding: 0.375rem 0.75rem; border-radius: 6px; text-transform: uppercase; letter-spacing: 0.05em;">#PLANE</span>
                    {% elif 'freak' in personality.id|lower or 'wallet-freak' in personality.id|lower %}
                    <span style="background: #F5F3FF; color: #A855F7; font-size: 0.7rem; font-weight: 600; padding: 0.375rem 0.75rem; border-radius: 6px; text-transform: uppercase; letter-spacing: 0.05em;">#POSSESSED</span>
                    <span style="background: #F5F3FF; color: #A855F7; font-size: 0.7rem; font-weight: 600; padding: 0.375rem 0.75rem; border-radius: 6px; text-transform: uppercase; letter-spacing: 0.05em;">#CHURNING</span>
                    <span style="background: #F5F3FF; color: #A855F7; font-size: 0.7rem; font-weight: 600; padding: 0.375rem 0.75rem; border-radius: 6px; text-transform: uppercase; letter-spacing: 0.05em;">#MAXIMUM</span>
                    {% elif 'hunter' in personality.id|lower or 'value' in personality.id|lower %}
                    <span style="background: #ECFDF5; color: #10B981; font-size: 0.7rem; font-weight: 600; padding: 0.375rem 0.75rem; border-radius: 6px; text-transform: uppercase; letter-spacing: 0.05em;">#SAVE</span>
                    <span style="background: #ECFDF5; color: #10B981; font-size: 0.7rem; font-weight: 600; padding: 0.375rem 0.75rem; border-radius: 6px; text-transform: uppercase; letter-spacing: 0.05em;">#CASH</span>
                    <span style="background: #ECFDF5; color: #10B981; font-size: 0.7rem; font-weight: 600; padding: 0.375rem 0.75rem; border-radius: 6px; text-transform: uppercase; letter-spacing: 0.05em;">#BUDGET</span>
                    {% elif 'seeker' in personality.id|lower or 'experience' in personality.id|lower %}
                    <span style="background: #FDF2F8; color: #EC4899; font-size: 0.7rem; font-weight: 600; padding: 0.375rem 0.75rem; border-radius: 6px; text-transform: uppercase; letter-spacing: 0.05em;">#LUXURY</span>
                    <span style="background: #FDF2F8; color: #EC4899; font-size: 0.7rem; font-weight: 600; padding: 0.375rem 0.75rem; border-radius: 6px; text-transform: uppercase; letter-spacing: 0.05em;">#EXPERIENCE</span>
                    {% elif 'optimizer' in personality.id|lower %}
                    <span style="background: #F1F5F9; color: #475569; font-size: 0.7rem; font-weight: 600; padding: 0.375rem 0.75rem; border-radius: 6px; text-transform: uppercase; letter-spacing: 0.05em;">#EFFICIENT</span>
                    <span style="background: #F1F5F9; color: #475569; font-size: 0.7rem; font-weight: 600; padding: 0.375rem 0.75rem; border-radius: 6px; text-transform: uppercase; letter-spacing: 0.05em;">#OPTIMIZE</span>
                    {% else %}
                    <span style="background: #EEF2FF; color: #6366F1; font-size: 0.7rem; font-weight: 600; padding: 0.375rem 0.75rem; border-radius: 6px; text-transform: uppercase; letter-spacing: 0.05em;">#REWARDS</span>
                    {% endif %}
                </div>

                <!-- Card Stack Preview -->
                <div style="position: relative; width: 100%; height: 140px; margin-bottom: 1.5rem;">
                    <!-- Card 1 (Back Left) -->
                    <div style="position: absolute; bottom: 0; left: 10%; width: 35%; height: 90px;
                        {% if 'freak' in personality.id|lower or 'wallet-freak' in personality.id|lower %}
                            background: linear-gradient(135deg, #8B9BA7 0%, #6B7B88 100%);
                        {% elif 'jetsetter' in personality.id|lower %}
                            background: linear-gradient(135deg, #3B82F6 0%, #2563EB 100%);
                        {% elif 'hunter' in personality.id|lower or 'value' in personality.id|lower %}
                            background: linear-gradient(135deg, #10B981 0%, #059669 100%);
                        {% else %}
                            background: linear-gradient(135deg, #6366F1 0%, #4F46E5 100%);
                        {% endif %}
                        border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.15); transform: rotate(-8deg); z-index: 1;">
                        <div style="padding: 0.75rem; display: flex; flex-direction: column; justify-content: space-between; height: 100%; color: white;">
                            <div style="font-size: 0.5rem; font-weight: 600; letter-spacing: 0.1em;">
                                {% if 'freak' in personality.id|lower %}CAPITAL ONE{% elif 'jetsetter' in personality.id|lower %}CAPITAL ONE{% else %}CARD{% endif %}
                            </div>
                            <div style="font-size: 0.6rem; letter-spacing: 0.05em;">‚Ä¢‚Ä¢‚Ä¢‚Ä¢ 4242</div>
                        </div>
                    </div>
                    
                    <!-- Card 2 (Middle) -->
                    <div style="position: absolute; bottom: 10px; left: 25%; width: 35%; height: 90px;
                        {% if 'freak' in personality.id|lower or 'wallet-freak' in personality.id|lower %}
                            background: linear-gradient(135deg, #3B82F6 0%, #2563EB 100%);
                        {% elif 'jetsetter' in personality.id|lower %}
                            background: linear-gradient(135deg, #1E293B 0%, #0F172A 100%);
                        {% elif 'hunter' in personality.id|lower or 'value' in personality.id|lower %}
                            background: linear-gradient(135deg, #14B8A6 0%, #0D9488 100%);
                        {% else %}
                            background: linear-gradient(135deg, #8B5CF6 0%, #7C3AED 100%);
                        {% endif %}
                        border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.15); transform: rotate(-2deg); z-index: 2;">
                        <div style="padding: 0.75rem; display: flex; flex-direction: column; justify-content: space-between; height: 100%; color: white;">
                            <div style="font-size: 0.5rem; font-weight: 600; letter-spacing: 0.1em;">
                                {% if 'jetsetter' in personality.id|lower %}CAPITAL ONE{% else %}CHASE{% endif %}
                            </div>
                            <div style="font-size: 0.6rem; letter-spacing: 0.05em;">‚Ä¢‚Ä¢‚Ä¢‚Ä¢ 1323</div>
                        </div>
                    </div>
                    
                    <!-- Card 3 (Front Right) -->
                    <div style="position: absolute; bottom: 20px; left: 40%; width: 35%; height: 90px;
                        {% if 'freak' in personality.id|lower or 'wallet-freak' in personality.id|lower %}
                            background: linear-gradient(135deg, #1E293B 0%, #0F172A 100%);
                        {% elif 'jetsetter' in personality.id|lower %}
                            background: linear-gradient(135deg, #8B9BA7 0%, #6B7B88 100%);
                        {% elif 'hunter' in personality.id|lower or 'value' in personality.id|lower %}
                            background: linear-gradient(135deg, #06B6D4 0%, #0891B2 100%);
                        {% else %}
                            background: linear-gradient(135deg, #EC4899 0%, #DB2777 100%);
                        {% endif %}
                        border-radius: 8px; box-shadow: 0 6px 16px rgba(0,0,0,0.2); transform: rotate(4deg); z-index: 3;">
                        <div style="padding: 0.75rem; display: flex; flex-direction: column; justify-content: space-between; height: 100%; color: white;">
                            <div style="font-size: 0.5rem; font-weight: 600; letter-spacing: 0.1em;">
                                {% if 'freak' in personality.id|lower %}CAPITAL ONE{% elif 'hunter' in personality.id|lower %}CITI{% else %}AMEX{% endif %}
                            </div>
                            <div style="font-size: 0.6rem; letter-spacing: 0.05em;">‚Ä¢‚Ä¢‚Ä¢‚Ä¢ 8888</div>
                        </div>
                    </div>
                </div>

                <!-- View Strategy Button -->
                <a href="{% url 'personality_detail' personality.id %}" style="width: 100%; padding: 1rem 1.5rem;
                    {% if 'freak' in personality.id|lower or 'wallet-freak' in personality.id|lower %}
                        background: #1E293B;
                    {% elif 'jetsetter' in personality.id|lower %}
                        background: #1E293B;
                    {% elif 'hunter' in personality.id|lower or 'value' in personality.id|lower %}
                        background: #1E293B;
                    {% else %}
                        background: #1E293B;
                    {% endif %}
                    color: white; border: none; border-radius: 12px; font-weight: 700; text-decoration: none; display: flex; align-items: center; justify-content: center; gap: 0.5rem; transition: all 0.3s; box-shadow: 0 4px 12px rgba(0,0,0,0.15);">
                    View Strategy
                    <span class="material-icons" style="font-size: 18px;">arrow_forward</span>
                </a>
            </div>
            {% empty %}
            <!-- Empty State -->
            <div style="text-align: center; padding: 4rem 2rem; grid-column: 1 / -1;">
                <div style="font-size: 4rem; margin-bottom: 1.5rem; opacity: 0.3;"><span class="material-icons" style="font-size: 64px;">credit_card</span></div>
                <h2 style="font-size: 1.5rem; font-weight: 700; margin-bottom: 0.75rem;">No personalities yet</h2>
                <p style="color: #64748B;">Check back soon!</p>
            </div>
            {% endfor %}
        </div>
    </div>
</section>

{% include 'cards/includes/card_modal.html' %}

<script>
    // Personalities data for quiz
    const PERSONALITY_IMAGES_PATH = "{% static 'images/personalities/' %}";
    const personalities = {{ personalities_json|safe }};
    const questions = {{ questions_json|safe }};
</script>
<script src="{% static 'js/personality_list.js' %}"></script>
{% endblock %}