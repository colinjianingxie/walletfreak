{% extends 'base.html' %}
{% load static %}

{% block main_style %}padding: 0; background: #F7F7F7; min-height: calc(100vh - 70px);{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/personality_list.css' %}">
<style>
    .assigned-personality-grid {
        display: grid;
        grid-template-columns: auto 1fr auto;
        gap: 2rem;
        align-items: center;
    }
    @media (max-width: 768px) {
        .assigned-personality-grid {
            grid-template-columns: 1fr;
            text-align: center;
            gap: 1.5rem;
        }
        .assigned-personality-grid > div:first-child { /* Icon */
            margin: 0 auto;
        }
        .assigned-personality-grid > a { /* Button */
            width: 100%;
            justify-content: center;
        }
    }
</style>
{% endblock %}

{% block content %}

<!-- Personalities Header with Quiz -->
<section class="personality-hero-section">
    <!-- Background decoration -->
    <div class="hero-blob-top"></div>
    <div class="hero-blob-bottom"></div>
    
    <div class="hero-content-wrapper">
        <!-- Badge -->
        <div class="hero-badge">
            <span class="hero-badge-icon"><span class="material-icons" style="font-size: 16px; vertical-align: middle;">auto_awesome</span></span>
            <span class="hero-badge-text">Discover Your Financial DNA</span>
        </div>
        
        <!-- Title -->
        <h1 class="hero-title">
            What's your <span class="hero-title-highlight">Wallet Vibe?</span>
        </h1>
        
        <!-- Subtitle (hidden during quiz, shown on initial load) -->
        <p id="quiz-subtitle-text" class="quiz-subtitle">
            Answer a few quick questions to discover your perfect credit card personality.
        </p>

        <!-- Quiz Container -->
        <div id="quiz-container" class="quiz-container-box">
            <!-- Progress Header -->
            <div class="progress-header">
                <div class="progress-labels">
                    <span id="question-counter" class="progress-text">QUESTION 1 OF 4</span>
                    <span id="progress-percent" class="progress-text">0% COMPLETE</span>
                </div>
                <!-- Progress Bar -->
                <div class="progress-bar-bg">
                    <div id="progress-bar" class="progress-bar-fill"></div>
                </div>
            </div>

            <!-- Question Text -->
            <h2 id="question-text" class="quiz-question-text"></h2>
            <p id="question-subtitle" class="quiz-question-subtitle"></p>

            <!-- Options Container -->
            <div id="options-container" class="quiz-options-grid">
                <!-- Options will be dynamically inserted here -->
            </div>

            <!-- Navigation Buttons -->
            <div class="quiz-nav-actions">
                <button id="back-btn" class="quiz-back-btn" onclick="previousQuestion()">
                    ‚Üê Back
                </button>
                <button id="continue-btn" class="quiz-continue-btn" onclick="nextQuestion()">
                    Continue ‚Üí
                </button>
            </div>
        </div>

        <!-- Loading Container (hidden initially) -->
        <div id="loading-container" class="loading-container-box">
            <!-- Spinner -->
            <div class="loading-spinner"></div>
            
            <h2 id="loading-title" class="loading-title">Analyzing your preferences...</h2>
            <p id="loading-subtitle" class="loading-subtitle">Crunching the multipliers</p>
        </div>

        <!-- Results Container (hidden initially) -->
        <div id="results-container" class="results-container-box">
            <p class="result-label">YOUR VIBE IS</p>
            
            <!-- Personality Avatar -->
            <div class="result-avatar-wrapper">
                <img id="result-image" src="" alt="Personality" class="result-avatar-img">
                <!-- Glow effect -->
                <div class="result-avatar-glow"></div>
            </div>

            <h2 id="result-name" class="result-title-name"></h2>
            <p id="result-description" class="result-description-text"></p>

            <!-- Action Buttons -->
            <div class="result-actions">
                <a id="view-stack-btn" href="#" class="view-stack-btn">
                    View Your Stack
                </a>
                <button onclick="resetQuiz()" class="restart-quiz-btn">
                    <span class="material-icons" style="font-size: 18px;">refresh</span>
                    Start Over
                </button>
            </div>
        </div>
    </div>
</section>

<!-- User's Assigned Personality (if exists) -->
{% if assigned_personality %}
<section class="container assigned-personality-section">
    <div class="assigned-personality-card">
<div class="assigned-personality-grid">
            <!-- Left: Icon -->
            <div class="assigned-icon-box">
                {{ assigned_personality.icon|default:"üéØ" }}
            </div>

            <!-- Middle: Info -->
            <div>
                <div class="assigned-label">
                    YOUR PERSONALITY
                </div>
                
                <h3 class="assigned-name">
                    {{ assigned_personality.name }}
                </h3>

                <p class="assigned-description">
                    {{ assigned_personality.tagline }}
                </p>
            </div>

            <!-- Right: Action -->
            <a href="{% url 'personality_detail' assigned_personality.id %}" class="assigned-view-btn">
                View Details
                <span class="material-icons" style="font-size: 18px;">arrow_forward</span>
            </a>
        </div>
    </div>
</section>
{% endif %}

<!-- Personalities Grid -->
<section class="explore-personalities-section">
    <div class="container">
        <!-- Header with Controls -->
        <div class="explore-header">
            <h2 class="explore-title">Explore All Personalities</h2>
            
            <div class="carousel-controls">
                <button class="carousel-btn" onclick="scrollCarousel(-1)">
                    <span class="material-icons" style="font-size: 20px;">chevron_left</span>
                </button>
                <button class="carousel-btn" onclick="scrollCarousel(1)">
                    <span class="material-icons" style="font-size: 20px;">chevron_right</span>
                </button>
            </div>
        </div>

        <div class="carousel-container-wrapper">
            <!-- Carousel Track -->
            <div id="personalities-carousel">
                {% for personality in personalities %}
                <div class="personality-slide">
                    <div class="personality-card-link personality-card-inner" data-name="{{ personality.name|lower }}"
                        data-desc="{{ personality.description|lower }}" data-tag="{{ personality.tagline|default:''|lower }}">
                        
                        <!-- Avatar Icon -->
                        <div class="personality-avatar-box">
                            <img src="{% static 'images/personalities/'|add:personality.slug|add:'.png' %}" alt="{{ personality.name }}" class="personality-img">
                        </div>

                        <!-- Personality Name -->
                        <h3 class="personality-name">
                            {{ personality.name }}
                        </h3>

                        <!-- Description -->
                        <p class="personality-desc">
                            {{ personality.description|truncatewords:20 }}
                        </p>

                        <!-- Tags -->
                        <div class="tags-container">
                            {% if 'jetsetter' in personality.id|lower %}
                            <span class="tag-badge tag-travel">#TRAVEL</span>
                            <span class="tag-badge tag-travel">#FLY</span>
                            <span class="tag-badge tag-travel">#PLANE</span>
                            {% elif 'freak' in personality.id|lower or 'wallet-freak' in personality.id|lower %}
                            <span class="tag-badge tag-freak">#POSSESSED</span>
                            <span class="tag-badge tag-freak">#CHURNING</span>
                            <span class="tag-badge tag-freak">#MAXIMUM</span>
                            {% elif 'hunter' in personality.id|lower or 'value' in personality.id|lower %}
                            <span class="tag-badge tag-save">#SAVE</span>
                            <span class="tag-badge tag-save">#CASH</span>
                            <span class="tag-badge tag-save">#BUDGET</span>
                            {% elif 'seeker' in personality.id|lower or 'experience' in personality.id|lower %}
                            <span class="tag-badge tag-luxury">#LUXURY</span>
                            <span class="tag-badge tag-luxury">#EXPERIENCE</span>
                            {% elif 'optimizer' in personality.id|lower %}
                            <span class="tag-badge tag-efficient">#EFFICIENT</span>
                            <span class="tag-badge tag-efficient">#OPTIMIZE</span>
                            {% else %}
                            <span class="tag-badge tag-rewards">#REWARDS</span>
                            {% endif %}
                        </div>

                        <!-- Card Stack Preview -->
                        <div class="card-stack-preview">
                            <!-- Card 1 (Back Left) -->
                            <div class="stack-card-base stack-card-1
                                {% if 'freak' in personality.id|lower or 'wallet-freak' in personality.id|lower %}
                                    bg-grad-freak
                                {% elif 'jetsetter' in personality.id|lower %}
                                    bg-grad-jetsetter-blue
                                {% elif 'hunter' in personality.id|lower or 'value' in personality.id|lower %}
                                    bg-grad-hunter
                                {% else %}
                                    bg-grad-indigo
                                {% endif %}">
                                <div class="stack-card-content">
                                    <div class="stack-card-issuer">
                                        {% if 'freak' in personality.id|lower %}CAPITAL ONE{% elif 'jetsetter' in personality.id|lower %}CAPITAL ONE{% else %}CARD{% endif %}
                                    </div>
                                    <div class="stack-card-number">‚Ä¢‚Ä¢‚Ä¢‚Ä¢ 4242</div>
                                </div>
                            </div>
                            
                            <!-- Card 2 (Middle) -->
                            <div class="stack-card-base stack-card-2
                                {% if 'freak' in personality.id|lower or 'wallet-freak' in personality.id|lower %}
                                    bg-grad-jetsetter-blue
                                {% elif 'jetsetter' in personality.id|lower %}
                                    bg-grad-jetsetter-dark
                                {% elif 'hunter' in personality.id|lower or 'value' in personality.id|lower %}
                                    bg-grad-hunter-teal
                                {% else %}
                                    bg-grad-purple
                                {% endif %}">
                                <div class="stack-card-content">
                                    <div class="stack-card-issuer">
                                        {% if 'jetsetter' in personality.id|lower %}CAPITAL ONE{% else %}CHASE{% endif %}
                                    </div>
                                    <div class="stack-card-number">‚Ä¢‚Ä¢‚Ä¢‚Ä¢ 1323</div>
                                </div>
                            </div>
                            
                            <!-- Card 3 (Front Right) -->
                            <div class="stack-card-base stack-card-3
                                {% if 'freak' in personality.id|lower or 'wallet-freak' in personality.id|lower %}
                                    bg-grad-jetsetter-dark
                                {% elif 'jetsetter' in personality.id|lower %}
                                    bg-grad-jetsetter-grey
                                {% elif 'hunter' in personality.id|lower or 'value' in personality.id|lower %}
                                    bg-grad-hunter-cyan
                                {% else %}
                                    bg-grad-pink
                                {% endif %}">
                                <div class="stack-card-content">
                                    <div class="stack-card-issuer">
                                        {% if 'freak' in personality.id|lower %}CAPITAL ONE{% elif 'hunter' in personality.id|lower %}CITI{% else %}AMEX{% endif %}
                                    </div>
                                    <div class="stack-card-number">‚Ä¢‚Ä¢‚Ä¢‚Ä¢ 8888</div>
                                </div>
                            </div>
                        </div>

                        <!-- View Strategy Button -->
                        <a href="{% url 'personality_detail' personality.id %}" class="view-strategy-btn">
                            View Strategy
                            <span class="material-icons" style="font-size: 18px;">arrow_forward</span>
                        </a>
                    </div>
                </div>
                {% empty %}
                <!-- Empty State -->
                <div class="empty-personalities-state">
                    <div class="empty-personalities-icon"><span class="material-icons" style="font-size: 64px;">credit_card</span></div>
                    <h2 style="font-size: 1.5rem; font-weight: 700; margin-bottom: 0.75rem;">No personalities yet</h2>
                    <p style="color: #64748B;">Check back soon!</p>
                </div>
                {% endfor %}
            </div>
        </div>
    </div>
</section>



<script>
    // Personalities data for quiz
    const PERSONALITY_IMAGES_PATH = "{% static 'images/personalities/' %}";
    const personalities = {{ personalities_json|safe }};
    const questions = {{ questions_json|safe }};
</script>
<script src="{% static 'js/personality_list.js' %}"></script>
{% endblock %}