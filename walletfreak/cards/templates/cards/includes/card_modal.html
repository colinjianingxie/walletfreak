<!-- Card Detail Modal -->
<div id="card-modal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(15, 23, 42, 0.6); backdrop-filter: blur(8px); z-index: 1000; align-items: center; justify-content: center; opacity: 0; transition: opacity 0.3s;">
    <div class="modal-content" style="background: #F8FAFC; width: 90%; max-width: 900px; border-radius: 32px; overflow: hidden; display: flex; box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25); transform: scale(0.95); transition: transform 0.3s;">
        
        <!-- Left Side: Card Visual -->
        <div style="width: 40%; background: linear-gradient(135deg, #F1F5F9 0%, #E2E8F0 100%); padding: 3rem; display: flex; flex-direction: column; align-items: center; justify-content: center; position: relative;">
            <div id="modal-card-visual" style="width: 280px; height: 176px; background: linear-gradient(135deg, #FFD700 0%, #B8860B 100%); border-radius: 16px; box-shadow: 0 20px 40px rgba(0,0,0,0.2); position: relative; overflow: hidden; padding: 1.25rem; display: flex; flex-direction: column; justify-content: space-between; color: white;">
                <!-- Card content will be injected via JS -->
                <div style="font-size: 0.75rem; font-weight: 600; letter-spacing: 0.1em;" id="modal-card-issuer-visual">AMERICAN EXPRESS</div>
                <div style="display: flex; gap: 4px; margin: 1rem 0;">
                    <div style="width: 32px; height: 24px; background: rgba(255,255,255,0.2); border-radius: 4px;"></div>
                </div>
                <div style="font-size: 1rem; letter-spacing: 0.15em; font-family: 'Courier New', monospace;" id="modal-card-number">•••• •••• •••• 4242</div>
                <div style="display: flex; justify-content: space-between; align-items: flex-end;">
                    <div style="font-size: 0.75rem;" id="modal-card-holder">YOUR NAME</div>
                    <div style="display: flex; gap: 2px;">
                        <div style="width: 18px; height: 18px; background: #EB001B; border-radius: 50%;"></div>
                        <div style="width: 18px; height: 18px; background: #F79E1B; border-radius: 50%; margin-left: -6px;"></div>
                    </div>
                </div>
            </div>
            
            <div style="margin-top: 2rem; text-align: center;">
                <div style="background: white; border-radius: 10px; padding: 0.5rem 1rem; display: inline-flex; align-items: center; gap: 0.4rem; box-shadow: 0 2px 4px -1px rgba(0, 0, 0, 0.1);">
                    <span style="color: #F59E0B; font-size: 18px;" class="material-icons">star</span>
                    <span style="font-weight: 700; color: #1E293B; font-size: 0.9rem;">Recommended</span>
                </div>
                <div style="margin-top: 1rem;">
                    <div style="font-size: 0.7rem; color: #64748B; font-weight: 600; letter-spacing: 0.1em; text-transform: uppercase;">ANNUAL FEE</div>
                    <div id="modal-annual-fee" style="font-size: 1.75rem; font-weight: 800; color: #0F172A;">$250</div>
                </div>
            </div>
        </div>

        <!-- Right Side: Details -->
        <div style="width: 60%; padding: 3rem; position: relative; max-height: 90vh; overflow-y: auto;">
            <button onclick="closeCardModal()" style="position: absolute; top: 1.5rem; right: 1.5rem; background: none; border: none; cursor: pointer; color: #94A3B8; transition: color 0.2s;">
                <span class="material-icons" style="font-size: 24px;">close</span>
            </button>

            <h2 id="modal-card-name" style="font-size: 2rem; font-weight: 800; color: #0F172A; margin: 0 0 0.25rem 0; line-height: 1.1;">Gold Card</h2>
            <div id="modal-issuer" style="font-size: 1rem; color: #64748B; margin-bottom: 1.5rem;">American Express</div>

            <!-- Freak Verdict -->
            <div style="background: #F5F3FF; border: 1px solid #E9D5FF; border-radius: 12px; padding: 1rem; margin-bottom: 1.5rem; display: flex; gap: 0.75rem;">
                <div style="width: 32px; height: 32px; background: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; flex-shrink: 0; color: #7C3AED;">
                    <span class="material-icons" style="font-size: 18px;">bolt</span>
                </div>
                <div>
                    <div style="font-size: 0.7rem; font-weight: 700; color: #4C1D95; letter-spacing: 0.05em; margin-bottom: 0.25rem;">THE FREAK VERDICT</div>
                    <p id="modal-verdict" style="margin: 0; color: #4B5563; line-height: 1.5; font-size: 0.9rem;">
                        The absolute king of food points. If you eat, you need this card. The credits effectively lower the fee to $10.
                    </p>
                </div>
            </div>



            <!-- Welcome Offer -->
            <div id="modal-welcome-offer-container" style="display: none; margin-bottom: 2rem;">
                <div style="display: flex; align-items: center; gap: 0.5rem; margin-bottom: 0.75rem; color: #94A3B8; font-weight: 600; font-size: 0.75rem; letter-spacing: 0.05em; text-transform: uppercase;">
                    <span class="material-icons" style="font-size: 16px;">card_giftcard</span> WELCOME OFFER
                </div>
                <div style="background: #F8FAFC; border: 1px solid #E2E8F0; border-radius: 12px; padding: 1.25rem 1.5rem; display: flex; align-items: center; gap: 1.5rem;">
                    <div style="flex: 1;">
                        <div style="display: flex; align-items: baseline; gap: 0.4rem;">
                            <div id="modal-welcome-value" style="font-size: 1.75rem; font-weight: 800; color: #0F172A; line-height: 1;">
                                60,000
                            </div>
                            <div id="modal-welcome-currency" style="font-size: 1rem; font-weight: 700; color: #0F172A;">
                                Points
                            </div>
                        </div>
                    </div>
                    <div style="width: 1px; height: 32px; background: #E2E8F0;"></div>
                    <div id="modal-welcome-terms" style="flex: 1; color: #64748B; font-size: 0.8rem; line-height: 1.4; font-weight: 500;">
                        after $4k spend in 6 months
                    </div>
                </div>
            </div>

            <div style="height: 1px; background: #E2E8F0; margin-bottom: 1.5rem;"></div>

            <!-- All Benefits -->
            <div style="margin-bottom: 3rem;">
                <div style="display: flex; align-items: center; gap: 0.5rem; margin-bottom: 1.5rem; color: #94A3B8; font-weight: 600; font-size: 0.875rem; letter-spacing: 0.05em;">
                    <span class="material-icons" style="font-size: 18px;">card_giftcard</span> BENEFITS
                </div>
                <div id="modal-all-benefits">
                    <!-- Injected via JS -->
                </div>
            </div>

            <!-- Actions -->
            <div style="display: flex; gap: 1rem;">
                <button id="add-wallet-btn" onclick="addToWalletFromModal()" style="flex: 1; background: #0F172A; color: white; border: none; padding: 1rem; border-radius: 12px; font-weight: 600; font-size: 1rem; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 0.5rem; transition: all 0.2s;">
                    <span id="add-wallet-text">Add to Wallet</span>
                    <span class="material-icons" id="add-wallet-icon">check</span>
                    <span class="material-icons" id="add-wallet-loader" style="display: none; animation: spin 1s linear infinite;">hourglass_empty</span>
                </button>
                <a id="modal-apply-link" href="#" target="_blank" style="padding: 1rem 2rem; background: white; color: #0F172A; border: 1px solid #E2E8F0; border-radius: 12px; font-weight: 600; font-size: 1rem; text-decoration: none; display: flex; align-items: center; gap: 0.5rem; transition: background 0.2s;">
                    Apply <span class="material-icons" style="font-size: 18px;">open_in_new</span>
                </a>
            </div>
            
            <div style="margin-top: 1.5rem; text-align: center; font-size: 0.75rem; color: #94A3B8;">
                Variable APR: 21.24% - 29.24% Var. Terms apply. Rates as of Oct 2024.
            </div>
        </div>
    </div>
</div>

<!-- Success Modal -->
<div id="success-modal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(15, 23, 42, 0.8); backdrop-filter: blur(8px); z-index: 2000; align-items: center; justify-content: center; opacity: 0; transition: opacity 0.3s;">
    <div style="background: white; width: 90%; max-width: 400px; border-radius: 24px; padding: 3rem 2rem; text-align: center; box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25); transform: scale(0.95); transition: transform 0.3s;">
        <div style="width: 64px; height: 64px; background: #10B981; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 1.5rem;">
            <span class="material-icons" style="font-size: 36px; color: white;">check_circle</span>
        </div>
        <h3 style="font-size: 1.5rem; font-weight: 800; color: #0F172A; margin: 0 0 0.5rem 0;">Card Added!</h3>
        <p style="color: #64748B; margin: 0 0 2rem 0; font-size: 0.95rem;">Successfully added to your wallet</p>
        <button onclick="closeSuccessModal()" style="width: 100%; background: #0F172A; color: white; border: none; padding: 1rem; border-radius: 12px; font-weight: 600; font-size: 1rem; cursor: pointer;">
            Got it!
        </button>
    </div>
</div>

<style>
@keyframes spin {
    from { transform: rotate(0deg); }
    to { transform: rotate(360deg); }
}

/* Accordion styles for card modal */
.modal-benefit-accordion {
    cursor: pointer;
    transition: all 0.2s;
}

.modal-benefit-accordion:hover {
    background: #F1F5F9 !important;
}

.modal-benefit-details {
    max-height: 0;
    overflow: hidden;
    transition: max-height 0.3s ease-out;
}

.modal-benefit-details.expanded {
    max-height: 500px;
    transition: max-height 0.3s ease-in;
}

.modal-chevron-icon {
    transition: transform 0.3s;
}

.modal-chevron-icon.rotated {
    transform: rotate(90deg);
}
</style>

<script>
let currentModalCardId = null;
const allCardsData = {{ cards_json|safe }};

function openCardModal(cardId) {
    currentModalCardId = cardId;
    const card = allCardsData[cardId];
    
    if (!card) {
        console.error('Card not found:', cardId);
        return;
    }
    
    // Update card name and issuer
    document.getElementById('modal-card-name').textContent = card.name || 'Credit Card';
    document.getElementById('modal-issuer').textContent = card.issuer || 'Issuer';
    document.getElementById('modal-card-issuer-visual').textContent = (card.issuer || 'CREDIT CARD').toUpperCase();
    
    // Update annual fee
    const annualFee = card.annual_fee || 0;
    document.getElementById('modal-annual-fee').textContent = '$' + annualFee;
    
    // Update card visual background color based on issuer
    const cardVisual = document.getElementById('modal-card-visual');
    if (card.issuer && card.issuer.toLowerCase().includes('american express')) {
        if (card.name.toLowerCase().includes('platinum')) {
            cardVisual.style.background = 'linear-gradient(135deg, #8B9BA7 0%, #6B7B88 100%)';
        } else if (card.name.toLowerCase().includes('gold')) {
            cardVisual.style.background = 'linear-gradient(135deg, #FFD700 0%, #DAA520 100%)';
        } else {
            cardVisual.style.background = 'linear-gradient(135deg, #8B9BA7 0%, #6B7B88 100%)';
        }
    } else if (card.issuer && card.issuer.toLowerCase().includes('chase')) {
        cardVisual.style.background = 'linear-gradient(135deg, #3B82F6 0%, #2563EB 100%)';
    } else if (card.issuer && card.issuer.toLowerCase().includes('capital one')) {
        cardVisual.style.background = 'linear-gradient(135deg, #1E293B 0%, #0F172A 100%)';
    } else {
        cardVisual.style.background = 'linear-gradient(135deg, #6B7280 0%, #4B5563 100%)';
    }
    
    // Update verdict
    const verdict = card.verdict || card.description || 'This card offers great value for your spending needs.';
    document.getElementById('modal-verdict').textContent = verdict;
    
    // Welcome Offer
    const welcomeOffer = card.sign_up_bonus;
    const welcomeContainer = document.getElementById('modal-welcome-offer-container');
    
    if (welcomeOffer && welcomeOffer.value > 0) {
        welcomeContainer.style.display = 'block';
        
        let valueNum = '';
        let valueCurrency = '';
        
        if (welcomeOffer.currency && welcomeOffer.currency.toLowerCase() === 'cash') {
            valueNum = `$${welcomeOffer.value}`;
            valueCurrency = 'Cash Back';
        } else {
            valueNum = welcomeOffer.value.toLocaleString();
            valueCurrency = welcomeOffer.currency || 'Points';
        }
        
        document.getElementById('modal-welcome-value').textContent = valueNum;
        document.getElementById('modal-welcome-currency').textContent = valueCurrency;
        document.getElementById('modal-welcome-terms').textContent = welcomeOffer.terms || '';
    } else {
        welcomeContainer.style.display = 'none';
    }
    
    // Parse benefits from Firestore structure
    const benefits = card.benefits || [];
    const allBenefitsContainer = document.getElementById('modal-all-benefits');
    allBenefitsContainer.innerHTML = '';
    
    if (benefits.length > 0) {
        // Separate benefits into multipliers and credits
        const multipliers = [];
        const credits = [];
        
        benefits.forEach((benefit) => {
            const desc = benefit.description || '';
            const shortDesc = benefit.short_description || desc;
            const additionalDetails = benefit.additional_details || '';
            const benefitType = benefit.benefit_type || '';
            const numericValue = benefit.numeric_value;
            
            // Format value based on type
            let formattedValue = '';
            if (benefitType === 'Multiplier' && numericValue) {
                formattedValue = `${numericValue}x`;
            } else if (benefitType === 'Cashback' && numericValue) {
                formattedValue = `${numericValue}%`;
            } else if (benefitType === 'Credit' && numericValue) {
                formattedValue = `$${numericValue}`;
            } else if (benefitType === 'Bonus' && numericValue) {
                 // Heuristic for points vs percent if not explicit, but usually points for bonus
                 // If it's small (<=100), maybe percent? But usually bonus is points.
                 // Let's just show the number if we can't be sure, or rely on description.
                 // For now, let's leave it empty or try to parse if needed, but the design focuses on Multipliers/Credits.
                 // Actually, let's use the numeric value if reasonable.
                 formattedValue = numericValue.toLocaleString();
            }

            const benefitData = {
                description: desc,
                shortDescription: shortDesc,
                additionalDetails: additionalDetails,
                formattedValue: formattedValue,
                benefitType: benefitType
            };
            
            if (benefitType === 'Credit') {
                credits.push(benefitData);
            } else if (benefitType === 'Multiplier' || benefitType === 'Cashback') {
                multipliers.push(benefitData);
            } else {
                // For now, put others in multipliers or ignore? 
                // The design only has 2 columns. Let's put 'Perk', 'Access', 'Status' etc. in a separate list or append to one?
                // User said "Represent it properly".
                // Let's add them to a "Perks" list if we had one, but we don't in the design.
                // Let's treat them as "Multipliers" (left column) for layout balance if they are important, 
                // or maybe just "Credits" (right column) if they are monetary-like.
                // Actually, let's put them in the left column for now as "Other Benefits" if needed, 
                // but strictly speaking the design shows "Multipliers" and "Credits".
                // Let's add them to multipliers list but without the blue badge if no value.
                multipliers.push(benefitData);
            }
        });
        
        // Render 2-column layout
        let html = `
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 2rem;">
                <!-- Multipliers / Earning Rates Column -->
                <div>
                    <div style="display: flex; align-items: center; gap: 0.5rem; margin-bottom: 0.75rem; color: #94A3B8; font-weight: 600; font-size: 0.7rem; letter-spacing: 0.05em; text-transform: uppercase;">
                        <span class="material-icons" style="font-size: 14px;">trending_up</span> EARNING RATES
                    </div>
                    <div style="display: flex; flex-direction: column; gap: 0.5rem;">
        `;
        
        if (multipliers.length > 0) {
            multipliers.forEach((benefit, idx) => {
                const benefitId = `modal-mult-${idx}`;
                html += `
                    <div style="background: white; border: 1px solid #F1F5F9; border-radius: 8px; overflow: hidden; transition: all 0.2s;">
                        <div class="modal-benefit-accordion" onclick="toggleModalBenefitAccordion('${benefitId}')" style="display: flex; justify-content: space-between; align-items: center; padding: 0.75rem; cursor: pointer;">
                            <div style="display: flex; align-items: center; gap: 0.4rem;">
                                <span class="material-icons modal-chevron-icon" id="${benefitId}-icon" style="font-size: 14px; color: #CBD5E1;">chevron_right</span>
                                <span style="color: #334155; font-size: 0.8rem; font-weight: 600;">${benefit.shortDescription}</span>
                            </div>
                            ${benefit.formattedValue ? `<div style="font-size: 0.75rem; font-weight: 700; color: #2563EB; background: #EFF6FF; padding: 0.2rem 0.5rem; border-radius: 4px;">${benefit.formattedValue}</div>` : ''}
                        </div>
                        <div class="modal-benefit-details" id="${benefitId}" style="padding: 0 0.75rem; background: #F8FAFC;">
                            <div style="padding: 0.5rem 0; border-top: 1px solid #F1F5F9;">
                                <div style="font-size: 0.75rem; color: #64748B; line-height: 1.5;">${benefit.description}</div>
                                ${benefit.additionalDetails ? `<div style="font-size: 0.7rem; color: #94A3B8; margin-top: 0.25rem; line-height: 1.4;">${benefit.additionalDetails}</div>` : ''}
                            </div>
                        </div>
                    </div>
                `;
            });
        } else {
            html += `<div style="color: #94A3B8; font-size: 0.85rem; font-style: italic;">No multipliers</div>`;
        }
        
        html += `
                    </div>
                </div>
                
                <!-- Credits Column -->
                <div>
                    <div style="display: flex; align-items: center; gap: 0.5rem; margin-bottom: 0.75rem; color: #94A3B8; font-weight: 600; font-size: 0.7rem; letter-spacing: 0.05em; text-transform: uppercase;">
                        <span class="material-icons" style="font-size: 14px;">verified_user</span> CREDITS
                    </div>
                    <div style="display: flex; flex-direction: column; gap: 0.5rem;">
        `;
        
        if (credits.length > 0) {
            credits.forEach((benefit, idx) => {
                const benefitId = `modal-credit-${idx}`;
                html += `
                    <div style="background: white; border: 1px solid #F1F5F9; border-radius: 8px; overflow: hidden; transition: all 0.2s;">
                        <div class="modal-benefit-accordion" onclick="toggleModalBenefitAccordion('${benefitId}')" style="display: flex; justify-content: space-between; align-items: center; padding: 0.75rem; cursor: pointer;">
                            <div style="display: flex; align-items: center; gap: 0.4rem;">
                                <span class="material-icons modal-chevron-icon" id="${benefitId}-icon" style="font-size: 14px; color: #CBD5E1;">chevron_right</span>
                                <span style="color: #334155; font-size: 0.8rem; font-weight: 600;">${benefit.shortDescription}</span>
                            </div>
                            <div style="font-size: 0.75rem; font-weight: 700; color: #16A34A; background: #DCFCE7; padding: 0.2rem 0.5rem; border-radius: 4px;">${benefit.formattedValue}</div>
                        </div>
                        <div class="modal-benefit-details" id="${benefitId}" style="padding: 0 0.75rem; background: #F8FAFC;">
                            <div style="padding: 0.5rem 0; border-top: 1px solid #F1F5F9;">
                                <div style="font-size: 0.75rem; color: #64748B; line-height: 1.5;">${benefit.description}</div>
                                ${benefit.additionalDetails ? `<div style="font-size: 0.7rem; color: #94A3B8; margin-top: 0.25rem; line-height: 1.4;">${benefit.additionalDetails}</div>` : ''}
                            </div>
                        </div>
                    </div>
                `;
            });
        } else {
            html += `<div style="color: #94A3B8; font-size: 0.85rem; font-style: italic;">No credits</div>`;
        }
        
        html += `
                    </div>
                </div>
            </div>
        `;
        
        allBenefitsContainer.innerHTML = html;
    } else {
        allBenefitsContainer.innerHTML = '<div style="color: #9CA3AF; font-size: 0.875rem; text-align: center; padding: 1rem;">No benefits available</div>';
    }
    
    // Update apply link
    const applyLink = document.getElementById('modal-apply-link');
    applyLink.href = card.application_url || '#';
    
    // Show modal with animation
    const modal = document.getElementById('card-modal');
    modal.style.display = 'flex';
    setTimeout(() => {
        modal.style.opacity = '1';
        modal.querySelector('.modal-content').style.transform = 'scale(1)';
    }, 10);
}

function closeCardModal() {
    const modal = document.getElementById('card-modal');
    modal.style.opacity = '0';
    modal.querySelector('.modal-content').style.transform = 'scale(0.95)';
    setTimeout(() => {
        modal.style.display = 'none';
    }, 300);
    currentModalCardId = null;
}

function addToWalletFromModal() {
    if (!currentModalCardId) return;
    
    // Show loader
    const btn = document.getElementById('add-wallet-btn');
    const text = document.getElementById('add-wallet-text');
    const icon = document.getElementById('add-wallet-icon');
    const loader = document.getElementById('add-wallet-loader');
    
    btn.disabled = true;
    btn.style.opacity = '0.6';
    btn.style.cursor = 'not-allowed';
    text.textContent = 'Adding...';
    icon.style.display = 'none';
    loader.style.display = 'inline-block';
    
    // Submit form
    const form = document.createElement('form');
    form.method = 'POST';
    form.action = `/dashboard/add-card/${currentModalCardId}/`;
    
    const csrfInput = document.createElement('input');
    csrfInput.type = 'hidden';
    csrfInput.name = 'csrfmiddlewaretoken';
    csrfInput.value = getCookie('csrftoken');
    form.appendChild(csrfInput);
    
    // Add hidden input for AJAX detection
    const ajaxInput = document.createElement('input');
    ajaxInput.type = 'hidden';
    ajaxInput.name = 'ajax';
    ajaxInput.value = '1';
    form.appendChild(ajaxInput);
    
    document.body.appendChild(form);
    
    // Use fetch to submit as AJAX
    const formData = new FormData(form);
    
    fetch(form.action, {
        method: 'POST',
        body: formData,
        headers: {
            'X-Requested-With': 'XMLHttpRequest'
        }
    })
    .then(res => res.json())
    .then(data => {
        // Remove form
        document.body.removeChild(form);
        
        // Reset button
        btn.disabled = false;
        btn.style.opacity = '1';
        btn.style.cursor = 'pointer';
        text.textContent = 'Add to Wallet';
        icon.style.display = 'inline-block';
        loader.style.display = 'none';
        
        if (data.success) {
            closeCardModal();
            showSuccessModal();
        } else {
            alert(data.error || 'Failed to add card');
        }
    })
    .catch(err => {
        // Remove form
        if (document.body.contains(form)) {
            document.body.removeChild(form);
        }
        
        // Reset button
        btn.disabled = false;
        btn.style.opacity = '1';
        btn.style.cursor = 'pointer';
        text.textContent = 'Add to Wallet';
        icon.style.display = 'inline-block';
        loader.style.display = 'none';
        
        console.error('Error adding card:', err);
        alert('Failed to add card to wallet');
    });
}

function showSuccessModal() {
    const modal = document.getElementById('success-modal');
    modal.style.display = 'flex';
    setTimeout(() => {
        modal.style.opacity = '1';
        modal.querySelector('div > div').style.transform = 'scale(1)';
    }, 10);
}

function closeSuccessModal() {
    const modal = document.getElementById('success-modal');
    modal.style.opacity = '0';
    setTimeout(() => {
        modal.style.display = 'none';
        // Reload page to show updated wallet
        window.location.reload();
    }, 300);
}

function toggleModalBenefitAccordion(accordionId) {
    const details = document.getElementById(accordionId);
    const icon = document.getElementById(accordionId + '-icon');
    
    if (details && icon) {
        const isExpanded = details.classList.contains('expanded');
        
        if (isExpanded) {
            details.classList.remove('expanded');
            icon.classList.remove('rotated');
        } else {
            details.classList.add('expanded');
            icon.classList.add('rotated');
        }
    }
}

function getCookie(name) {
    let cookieValue = null;
    if (document.cookie && document.cookie !== '') {
        const cookies = document.cookie.split(';');
        for (let i = 0; i < cookies.length; i++) {
            const cookie = cookies[i].trim();
            if (cookie.substring(0, name.length + 1) === (name + '=')) {
                cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                break;
            }
        }
    }
    return cookieValue;
}

// Close modal on background click
document.addEventListener('DOMContentLoaded', function() {
    const modal = document.getElementById('card-modal');
    if (modal) {
        modal.addEventListener('click', function(e) {
            if (e.target === modal) {
                closeCardModal();
            }
        });
    }
});
</script>
