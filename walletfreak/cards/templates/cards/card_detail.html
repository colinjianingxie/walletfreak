{% extends 'base.html' %}
{% load static %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/card_detail.css' %}">
{% endblock %}

{% block content %}
<div class="container card-detail-container">
    <div class="card card-detail-wrapper">
        <h1 class="card-title">{{ card.name }}</h1>
        <p class="card-issuer">{{ card.issuer }}</p>

        <div class="card-info-grid">
            <div>
                <h3>Rewards Structure</h3>
                <ul class="rewards-list">
                    {% if card.rewards_structure %}
                        {% if card.rewards_structure.details %}
                        <div class="rewards-detail-text">{{ card.rewards_structure.details }}</div>
                        {% else %}
                        {% for key, value in card.rewards_structure.items %}
                        <li class="rewards-list-item"><strong>{{ value }}</strong> on {{ key }}</li>
                        {% endfor %}
                        {% endif %}
                    {% elif card.earning_rates %}
                        {% for rate in card.earning_rates %}
                        <li class="rewards-list-item">
                            <strong>
                                {% if rate.currency == 'cash' or rate.currency == 'Cashback' %}{{ rate.rate }}%{% else %}{{ rate.rate }}x{% endif %}
                            </strong> 
                            on {{ rate.category|join:", " }}
                        </li>
                        {% endfor %}
                    {% endif %}
                </ul>
            </div>
            <div>
                <h3>Key Details</h3>
                <p class="key-details-text"><strong>Annual Fee:</strong> ${{ card.annual_fee }}</p>
                {% if card.user_type %}
                <p><strong>Best For:</strong> {{ card.user_type|join:", " }}</p>
                {% endif %}
            </div>
        </div>

        {% if card.benefits %}
        <h3 class="benefits-title">Benefits</h3>
        <div class="benefits-grid">
            {% for benefit in card.benefits %}
            <div class="benefit-card">
                <h4 class="benefit-name">{{ benefit.name }}</h4>
                <p class="benefit-description">{{ benefit.description }}</p>
                {% if benefit.amount %}
                <p class="benefit-value">Value: ${{ benefit.amount }} ({{ benefit.type }})</p>
                {% endif %}
            </div>
            {% endfor %}
        </div>
        {% endif %}

        <div class="action-buttons-container">
            <form action="{% url 'add_card' card.id %}" method="POST">
                {% csrf_token %}
                <input type="hidden" name="status" value="active">
                <button type="submit" class="btn btn-primary">Add to Wallet</button>
            </form>
            <form action="{% url 'add_card' card.id %}" method="POST">
                {% csrf_token %}
                <input type="hidden" name="status" value="eyeing">
                <button type="submit" class="btn btn-outline">Add to Wishlist</button>
            </form>
        </div>

        <div class="application-section">
            {% if active_link %}
            <a href="{{ active_link }}" target="_blank" class="btn btn-primary apply-btn">Apply Now</a>
            {% else %}
            <button class="btn btn-primary apply-btn" disabled>Application Unavailable</button>
            {% endif %}
            <p class="disclaimer-text">* We may earn a commission if you apply through our links.</p>
        </div>
    </div>
</div>
{% endblock %}