{% extends 'base.html' %}

{% block content %}
<!-- Explore Cards Header -->
<div style="margin-bottom: 2.5rem;">
    <div style="display: flex; align-items: center; gap: 0.75rem; margin-bottom: 1rem;">
        <span style="font-size: 1.25rem;">ü§ñ</span>
        <span style="color: var(--primary); font-size: 0.85rem; font-weight: 700; letter-spacing: 0.1em;">AI
            RECOMMENDATIONS</span>
    </div>

    <h1 style="font-size: 2rem; font-weight: 700; margin: 0 0 0.5rem 0;">Explore Cards</h1>
    <p style="color: var(--text-muted); margin: 0;">Based on your spending profile (The Jetsetter), these cards will
        maximize your return.</p>
</div>

<!-- Search and Filters -->
<div
    style="background: white; border-radius: var(--radius-lg); padding: 1.5rem; margin-bottom: 2rem; border: 1px solid #E5E7EB; box-shadow: var(--elevation-1);">
    <div style="display: grid; grid-template-columns: 1fr auto; gap: 1rem; align-items: center;">
        <!-- Search Bar -->
        <div style="position: relative;">
            <span
                style="position: absolute; left: 1rem; top: 50%; transform: translateY(-50%); color: var(--text-muted); font-size: 1.1rem;">üîç</span>
            <input type="text" id="search-input" placeholder="Search cards by name or issuer..."
                style="width: 100%; padding: 0.875rem 1rem 0.875rem 3rem; border: 1px solid #E5E7EB; border-radius: var(--radius-md); font-size: 0.95rem;">
        </div>

        <!-- Filter Pills + Filter Icon -->
        <div style="display: flex; align-items: center; gap: 0.75rem;">
            <div class="filter-pills" id="filter-pills" style="display: flex; gap: 0.5rem;">
                <button class="filter-pill active" data-category="all">All Cards</button>
                <button class="filter-pill" data-category="travel">Travel</button>
                <button class="filter-pill" data-category="cash-back">Cash Back</button>
                <button class="filter-pill" data-category="no-fee">No Fee</button>
            </div>
            <button
                style="background: none; border: 1px solid #E5E7EB; border-radius: var(--radius-md); padding: 0.5rem 0.75rem; cursor: pointer; display: flex; align-items: center; justify-content: center;"
                title="More Filters">
                <span style="font-size: 1.25rem;">‚öôÔ∏è</span>
            </button>
        </div>
    </div>
</div>

<!-- Cards Grid -->
<div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(340px, 1fr)); gap: 2rem;"
    id="cards-container">
    {% for card in cards %}
    <div class="card-item" data-name="{{ card.name|lower }}" data-issuer="{{ card.issuer|lower }}"
        data-categories="{{ card.categories|join:',' }}" data-fee="{{ card.annual_fee|default:0 }}"
        style="background: white; border-radius: var(--radius-lg); padding: 2rem; border: 1px solid #E5E7EB; box-shadow: var(--elevation-1); transition: all 0.3s;">
        <!-- 3D Credit Card -->
        <div class="credit-card {% if 'american express' in card.name|lower or 'amex' in card.name|lower %}{% if 'platinum' in card.name|lower %}card-amex-platinum{% else %}card-gold{% endif %}{% elif 'chase' in card.name|lower %}card-chase{% elif 'capital one' in card.name|lower %}card-capital-one{% elif 'citi' in card.name|lower %}card-citi{% else %}card-chase{% endif %}"
            style="margin-bottom: 1.5rem;">
            <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 1.5rem;">
                <div style="font-size: 0.7rem; font-weight: 600; letter-spacing: 0.1em;">
                    {{ card.issuer|upper|default:"CREDIT CARD" }}
                </div>
                <div style="font-size: 1rem;">üí≥</div>
            </div>
            <div class="credit-card-chip"></div>
            <div class="credit-card-number">‚Ä¢‚Ä¢‚Ä¢‚Ä¢ ‚Ä¢‚Ä¢‚Ä¢‚Ä¢ ‚Ä¢‚Ä¢‚Ä¢‚Ä¢ {{ forloop.counter }}234</div>
            <div style="display: flex; justify-content: space-between; align-items: flex-end;">
                <div class="credit-card-name">YOUR NAME</div>
                <div style="display: flex; gap: 0.25rem;">
                    <div style="width: 20px; height: 20px; background: #EB001B; border-radius: 50%; opacity: 0.9;">
                    </div>
                    <div
                        style="width: 20px; height: 20px; background: #F79E1B; border-radius: 50%; opacity: 0.9; margin-left: -8px;">
                    </div>
                </div>
            </div>
        </div>

        <!-- Card Details -->
        <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 1rem;">
            <div style="flex: 1;">
                <h3 style="font-size: 1.25rem; font-weight: 700; margin: 0 0 0.25rem 0; color: var(--dark);">
                    {{ card.name }}
                </h3>
                <div style="font-size: 0.85rem; color: var(--text-muted);">{{ card.issuer }}</div>
            </div>
            <div>
                <div
                    style="font-size: 1.75rem; font-weight: 700; color: var(--dark); text-align: right; line-height: 1;">
                    {% if forloop.counter == 1 %}98{% elif forloop.counter == 2 %}88{% else %}85{% endif %}%
                </div>
                <div
                    style="font-size: 0.75rem; color: var(--success); font-weight: 600; text-align: right; margin-top: 0.25rem;">
                    MATCH</div>
            </div>
        </div>

        <!-- Rewards Info -->
        <div
            style="display: flex; align-items: center; gap: 0.5rem; margin-bottom: 0.75rem; padding: 0.75rem; background: var(--bg-body); border-radius: var(--radius-md);">
            <span style="font-size: 1.1rem;">üéÅ</span>
            <div style="flex: 1;">
                <div
                    style="font-size: 0.75rem; color: var(--text-muted); text-transform: uppercase; letter-spacing: 0.05em; margin-bottom: 0.125rem;">
                    REWARDS</div>
                <div style="font-size: 0.9rem; font-weight: 600; color: var(--dark);">
                    {% if card.rewards_summary %}{{ card.rewards_summary }}{% else %}2x Everything{% endif %}
                </div>
            </div>
        </div>

        <!-- Annual Fee Info -->
        <div
            style="display: flex; align-items: center; gap: 0.5rem; margin-bottom: 1.5rem; padding: 0.75rem; background: var(--bg-body); border-radius: var(--radius-md);">
            <span style="font-size: 1.1rem;">üí∞</span>
            <div style="flex: 1;">
                <div
                    style="font-size: 0.75rem; color: var(--text-muted); text-transform: uppercase; letter-spacing: 0.05em; margin-bottom: 0.125rem;">
                    ANNUAL FEE</div>
                <div style="font-size: 0.9rem; font-weight: 600; color: var(--dark);">${{ card.annual_fee|default:0 }}
                </div>
            </div>
        </div>

        <!-- Apply Button -->
        <a href="{% url 'card_detail' card.id %}" class="btn"
            style="width: 100%; background: var(--dark); color: white; padding: 0.875rem; text-align: center; font-weight: 600; display: flex; align-items: center; justify-content: center; gap: 0.5rem; text-decoration: none;">
            Apply Now
            <span style="font-size: 0.9rem;">‚Üí</span>
        </a>
    </div>
    {% empty %}
    <!-- Empty State -->
    <div style="grid-column: 1 / -1; text-align: center; padding: 4rem 2rem;">
        <div style="font-size: 4rem; margin-bottom: 1.5rem; opacity: 0.3;">üí≥</div>
        <h2 style="font-size: 1.5rem; font-weight: 700; margin-bottom: 0.75rem;">No cards found</h2>
        <p style="color: var(--text-muted);">Try adjusting your filters or search query.</p>
    </div>
    {% endfor %}
</div>

<!-- No Results Message (hidden by default) -->
<div id="no-results" style="display: none; text-align: center; padding: 4rem 2rem;">
    <div style="font-size: 4rem; margin-bottom: 1.5rem; opacity: 0.3;">üîç</div>
    <h2 style="font-size: 1.5rem; font-weight: 700; margin-bottom: 0.75rem;">No cards match your filters</h2>
    <p style="color: var(--text-muted);">Try adjusting your search or filters.</p>
</div>

<script>
    const searchInput = document.getElementById('search-input');
    const filterPills = document.querySelectorAll('.filter-pill');
    const cardsContainer = document.getElementById('cards-container');
    const cardItems = document.querySelectorAll('.card-item');
    const noResults = document.getElementById('no-results');

    let activeCategory = 'all';

    // Search functionality
    searchInput.addEventListener('input', filterCards);

    // Filter pill functionality
    filterPills.forEach(pill => {
        pill.addEventListener('click', () => {
            filterPills.forEach(p => p.classList.remove('active'));
            pill.classList.add('active');
            activeCategory = pill.dataset.category;
            filterCards();
        });
    });

    function filterCards() {
        const query = searchInput.value.toLowerCase();
        let visibleCount = 0;

        cardItems.forEach(card => {
            const name = card.dataset.name;
            const issuer = card.dataset.issuer;
            const categories = card.dataset.categories.toLowerCase();
            const fee = parseFloat(card.dataset.fee);

            const matchesSearch = name.includes(query) || issuer.includes(query);

            let matchesCategory = true;
            if (activeCategory === 'travel') {
                matchesCategory = categories.includes('travel');
            } else if (activeCategory === 'cash-back') {
                matchesCategory = categories.includes('cash') || categories.includes('cashback');
            } else if (activeCategory === 'no-fee') {
                matchesCategory = fee === 0;
            }

            if (matchesSearch && matchesCategory) {
                card.style.display = 'block';
                visibleCount++;
            } else {
                card.style.display = 'none';
            }
        });

        if (visibleCount === 0) {
            cardsContainer.style.display = 'none';
            noResults.style.display = 'block';
        } else {
            cardsContainer.style.display = 'grid';
            noResults.style.display = 'none';
        }
    }

    // Hover effects
    cardItems.forEach(card => {
        card.addEventListener('mouseenter', () => {
            card.style.transform = 'translateY(-4px)';
            card.style.boxShadow = 'var(--elevation-4)';
        });

        card.addEventListener('mouseleave', () => {
            card.style.transform = 'translateY(0)';
            card.style.boxShadow = 'var(--elevation-1)';
        });
    });
</script>

<style>
    @media (max-width: 768px) {
        div[style*="grid-template-columns: 1fr auto"] {
            grid-template-columns: 1fr !important;
        }

        .filter-pills {
            flex-wrap: wrap;
        }

        div[style*="grid-template-columns: repeat(auto-fill, minmax(340px, 1fr))"] {
            grid-template-columns: 1fr !important;
        }
    }
</style>
{% endblock %}