{% load humanize %}

<div class="hh-results-container">
    <div class="hh-results-header">
        <h2 class="hh-results-title">Top Recommendations for You</h2>
        <span class="hh-results-subtitle">Based on your {{ active_cards_count|default:"0" }} active cards</span>
    </div>

    {% for hotel in hotels %}
    <div class="hh-card-new">
        <!-- Main Card Body -->
        <div class="hh-card-flex">
            <!-- Image Column -->
            <div class="hh-card-image-col">
                <img alt="{{ hotel.name }}" class="hh-card-image-full" src="{{ hotel.image_url|default:'https://images.unsplash.com/photo-1551882547-ff40c63fe5fa?auto=format&fit=crop&q=80&w=800' }}">
                
                {% if hotel.rating %}
                <div class="hh-img-badge-top">
                    <!-- Check if rating is sentiment (0-100) or stars (1-5) -->
                    {% if hotel.rating > 5 %}
                    <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="hh-star-icon filled"><path d="M11.525 2.295a.53.53 0 0 1 .95 0l2.31 4.679a2.123 2.123 0 0 0 1.595 1.16l5.166.756a.53.53 0 0 1 .294.904l-3.736 3.638a2.123 2.123 0 0 0-.611 1.878l.882 5.14a.53.53 0 0 1-.771.56l-4.618-2.428a2.122 2.122 0 0 0-1.973 0L6.396 21.01a.53.53 0 0 1-.77-.56l.881-5.139a2.122 2.122 0 0 0-.611-1.879L2.16 9.795a.53.53 0 0 1 .294-.906l5.165-.755a2.122 2.122 0 0 0 1.597-1.16z"></path></svg>
                    {{ hotel.rating }}
                    {% else %}
                    <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="hh-star-icon filled"><path d="M11.525 2.295a.53.53 0 0 1 .95 0l2.31 4.679a2.123 2.123 0 0 0 1.595 1.16l5.166.756a.53.53 0 0 1 .294.904l-3.736 3.638a2.123 2.123 0 0 0-.611 1.878l.882 5.14a.53.53 0 0 1-.771.56l-4.618-2.428a2.122 2.122 0 0 0-1.973 0L6.396 21.01a.53.53 0 0 1-.77-.56l.881-5.139a2.122 2.122 0 0 0-.611-1.879L2.16 9.795a.53.53 0 0 1 .294-.906l5.165-.755a2.122 2.122 0 0 0 1.597-1.16z"></path></svg>
                    {{ hotel.rating }}
                    {% endif %}
                </div>
                {% endif %}
                
                <div class="hh-img-badge-bottom">
                    <span class="hh-brand-pill">{{ hotel.loyalty_program|default:hotel.brand }}</span>
                </div>
            </div>

            <!-- Content Column -->
            <div class="hh-card-content-col">
                <div class="hh-card-header-row">
                    <div>
                        <h3 class="hh-hotel-name">{{ hotel.name }}</h3>
                        <p class="hh-hotel-loc">
                            <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M20 10c0 4.993-5.539 10.193-7.399 11.799a1 1 0 0 1-1.202 0C9.539 20.193 4 14.993 4 10a8 8 0 0 1 16 0"></path><circle cx="12" cy="10" r="3"></circle></svg> 
                            {{ hotel.location_text }}
                        </p>
                    </div>
                    <div class="hh-price-block">
                        <p class="hh-price-main">{{ hotel.currency }}{{ hotel.price|floatformat:0 }}</p>
                        <p class="hh-price-sub">per night</p>
                    </div>
                </div>

                <!-- Best Option Highlight (First Option) -->
                {% with best_opt=hotel.options|first %}
                {% if best_opt %}
                <div class="hh-best-option-box hh-accordion-trigger" data-target="methods-{{ forloop.counter }}">
                    <div class="hh-boa-left">
                        <div class="hh-boa-icon {{ best_opt.badge_class }}">
                            {% if best_opt.type == 'transfer' %}
                            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m16 3 4 4-4 4"></path><path d="M20 7H4"></path><path d="m8 21-4-4 4-4"></path><path d="M4 17h16"></path></svg>
                            {% elif best_opt.type == 'credit-card' %}
                            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect width="20" height="14" x="2" y="5" rx="2"></rect><line x1="2" x2="22" y1="10" y2="10"></line></svg>
                            {% else %}
                            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z"></path><path d="m9 12 2 2 4-4"></path></svg>
                            {% endif %}
                        </div>
                        <div class="hh-boa-text">
                            <div class="hh-boa-title-row">
                                <p class="hh-boa-title">{{ best_opt.title }}</p>
                                <span class="hh-boa-badge">BEST</span>
                            </div>
                            <p class="hh-boa-desc">{{ best_opt.description }}</p>
                        </div>
                    </div>
                    <div class="hh-boa-right" style="display: flex; gap: 0.75rem; align-items: center;">
                        <div class="hh-boa-price">
                            <p class="hh-boa-val">{{ best_opt.data_points }}</p>
                            <p class="hh-boa-sub {{ best_opt.badge_class }}">{{ best_opt.data_sub }}</p>
                        </div>
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="hh-chevron"><path d="m6 9 6 6 6-6"></path></svg>
                    </div>
                </div>
                {% endif %}
                {% endwith %}
            </div>
        </div>

        <!-- All Booking Methods List -->
        <div class="hh-options-section hh-accordion-content" id="methods-{{ forloop.counter }}">
            <h4 class="hh-options-header">All Booking Methods</h4>
            <div class="hh-options-list">
                {% for opt in hotel.options %}
                <div class="hh-option-row {% if opt.type == 'cobrand' %}hh-cobrand-row{% endif %}">
                    <div class="hh-opt-left">
                        <div class="hh-opt-icon {{ opt.badge_class }}">
                            {% if opt.type == 'transfer' %}
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m16 3 4 4-4 4"></path><path d="M20 7H4"></path><path d="m8 21-4-4 4-4"></path><path d="M4 17h16"></path></svg>
                            {% elif opt.type == 'credit-card' %}
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect width="20" height="14" x="2" y="5" rx="2"></rect><line x1="2" x2="22" y1="10" y2="10"></line></svg>
                            {% elif opt.type == 'cobrand' %}
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg>
                            {% else %}
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z"></path><path d="m9 12 2 2 4-4"></path></svg>
                            {% endif %}
                        </div>
                        <div>
                            <div class="hh-opt-title-row">
                                <h5 class="hh-opt-title">{{ opt.title }}</h5>
                                {% if opt.badge %}
                                <span class="hh-opt-badge {{ opt.badge_class }}">{{ opt.badge }}</span>
                                {% endif %}
                            </div>
                            <p class="hh-opt-desc">{{ opt.description }}</p>
                            
                            {% if opt.tags %}
                            <div class="hh-tag-row">
                                {% for tag in opt.tags %}
                                <span class="hh-opt-tag {{ tag.class }}">
                                    {% if 'Multiplier' in tag.text %}<svg xmlns="http://www.w3.org/2000/svg" width="10" height="10" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="12" x2="12" y1="2" y2="22"></line><path d="m17 5-9.5 14"></path></svg>{% endif %}
                                    {% if 'Status' in tag.text %}<svg xmlns="http://www.w3.org/2000/svg" width="10" height="10" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M11.562 3.266a.5.5 0 0 1 .876 0L15.39 8.87a1 1 0 0 0 1.516.294L21.183 5.5a.5.5 0 0 1 .798.519l-2.834 10.246a1 1 0 0 1-.956.734H5.81a1 1 0 0 1-.957-.734L2.02 6.02a.5.5 0 0 1 .798-.519l4.276 3.664a1 1 0 0 0 1.516-.294z"></path><path d="M5 21h14"></path></svg>{% endif %}
                                    {{ tag.text }}
                                </span>
                                {% endfor %}
                            </div>
                            {% endif %}

                            {% if opt.current_balance is not None %}
                            <div class="hh-opt-meta">
                                <span style="background-color: #f1f5f9; padding: 2px 6px; border-radius: 4px;">Current: {{ opt.current_balance|intcomma }}</span>
                                <span style="background-color: #f1f5f9; padding: 2px 6px; border-radius: 4px;">Needed: {{ opt.needed|intcomma }}</span>
                            </div>
                            {% endif %}
                        </div>
                    </div>
                    <div class="hh-opt-right">
                        <div class="hh-opt-price">
                            <div class="hh-opt-val">{{ opt.data_points }}</div>
                            <div class="hh-opt-sub">{{ opt.data_sub }}</div>
                        </div>
                        <button class="hh-opt-btn {{ opt.btn_class }}">{{ opt.btn_text }}</button>
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>
    </div>
    {% empty %}
    <div class="hh-empty-search-state">
        <p>No hotels found. Try searching for a city.</p>
    </div>
    {% endfor %}
</div>
