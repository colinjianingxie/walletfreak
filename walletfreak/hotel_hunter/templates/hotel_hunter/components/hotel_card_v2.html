{% load humanize %}
<div class="hh-card">
    <!-- Responsive Flex: Column on mobile, Row on desktop -->
    <div class="hh-flex hh-flex-col hh-md-row">
        <!-- Image Section: h-48 mobile (12rem), w-64 desktop (16rem/auto) -->
        <div class="hh-hotel-img-wrapper" style="height: 12rem;">
            <img class="hh-hotel-img" src="{{ hotel.image_url }}" alt="{{ hotel.name }}">
            <div class="hh-rating-badge">
                <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-star text-yellow-500 fill-yellow-500" style="color: #eab308; fill: #eab308;"><path d="M11.525 2.295a.53.53 0 0 1 .95 0l2.31 4.679a2.123 2.123 0 0 0 1.595 1.16l5.166.756a.53.53 0 0 1 .294.904l-3.736 3.638a2.123 2.123 0 0 0-.611 1.878l.882 5.14a.53.53 0 0 1-.771.56l-4.618-2.428a2.122 2.122 0 0 0-1.973 0L6.396 21.01a.53.53 0 0 1-.77-.56l.881-5.139a2.122 2.122 0 0 0-.611-1.879L2.16 9.795a.53.53 0 0 1 .294-.906l5.165-.755a2.122 2.122 0 0 0 1.597-1.16z"></path></svg>
                {{ hotel.rating|floatformat:1 }}
            </div>
        </div>

        <!-- Content Section -->
        <div class="hh-content">
            <!-- Header -->
            <div class="hh-flex hh-justify-between hh-items-start">
                <div>
                    <h2 class="hh-text-xl hh-font-bold hh-text-slate-900">{{ hotel.name }}</h2>
                    <p class="hh-text-slate-500 hh-text-sm hh-flex hh-items-center hh-gap-1" style="margin-bottom: 0.5rem; margin-top:0.25rem;">
                        <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-map-pin"><path d="M20 10c0 4.993-5.539 10.193-7.399 11.799a1 1 0 0 1-1.202 0C9.539 20.193 4 14.993 4 10a8 8 0 0 1 16 0"></path><circle cx="12" cy="10" r="3"></circle></svg>
                        {{ hotel.location_text }}
                    </p>
                </div>
                <div style="text-align: right;">
                    <div class="hh-text-2xl hh-font-bold hh-text-slate-900">${{ hotel.price|floatformat:0 }}</div>
                    <div class="hh-text-xs hh-text-slate-400 hh-font-medium">cash price</div>
                </div>
            </div>

            <!-- Recommended Strategy (Clickable Accordion Trigger) -->
            <div class="hh-rec-box hh-accordion-trigger" data-target="strat-{{ forloop.counter }}">
                <div class="hh-flex hh-items-center hh-gap-3">
                    <div class="hh-icon-circle">
                        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-trophy"><path d="M10 14.66v1.626a2 2 0 0 1-.976 1.696A5 5 0 0 0 7 21.978"></path><path d="M14 14.66v1.626a2 2 0 0 0 .976 1.696A5 5 0 0 1 17 21.978"></path><path d="M18 9h1.5a1 1 0 0 0 0-5H18"></path><path d="M4 22h16"></path><path d="M6 9a6 6 0 0 0 12 0V3a1 1 0 0 0-1-1H7a1 1 0 0 0-1 1z"></path><path d="M6 9H4.5a1 1 0 0 1 0-5H6"></path></svg>
                    </div>
                    <div>
                        <div class="hh-rec-label">Recommended Strategy</div>
                        <div class="hh-rec-value">
                            {{ hotel.winner.label }}
                            {% if hotel.winner.savings %}
                                <span class="hh-text-sm" style="color: var(--hh-green-600)">(Save ${{ hotel.winner.savings|floatformat:0 }})</span>
                            {% elif hotel.winner.savings_text %}
                                <span class="hh-text-sm" style="color: var(--hh-green-600)">({{ hotel.winner.savings_text }})</span>
                            {% endif %}
                        </div>
                    </div>
                </div>
                <div class="hh-text-slate-400">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-chevron-down"><path d="m6 9 6 6 6-6"></path></svg>
                </div>
            </div>
        </div>
    </div>

    <!-- Expanded Strategies Table -->
    <div id="strat-{{ forloop.counter }}" class="hh-strategies">
        <!-- Desktop Header (Hidden on Mobile) -->
        <div class="hh-table-header hh-md-flex hh-hidden">
            <div class="hh-col-method hh-md-w-1-3">Method & Card</div>
            <div class="hh-col-upfront hh-md-w-1-4">Upfront</div>
            <div class="hh-col-effective hh-md-w-1-4">Effective Cost</div>
            <div class="hh-col-verdict hh-md-w-1-6">Verdict</div>
        </div>

        {% for strategy in hotel.strategies %}
        <!-- Row Wrapper -->
        <div class="hh-row {% if strategy.is_winner %}winner{% endif %}">
            <div class="hh-flex hh-flex-col hh-md-row hh-w-full hh-md-items-center">
                
                <!-- Method Section (Mobile: Top Row, Desktop: Left Col) -->
                <div class="hh-md-w-1-3 hh-flex hh-items-start hh-gap-3">
                    <div class="hh-text-slate-900 hh-shrink-0" style="margin-top: 2px;">
                        {% if strategy.icon == 'star' %}
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide"><path d="M11.525 2.295a.53.53 0 0 1 .95 0l2.31 4.679a2.123 2.123 0 0 0 1.595 1.16l5.166.756a.53.53 0 0 1 .294.904l-3.736 3.638a2.123 2.123 0 0 0-.611 1.878l.882 5.14a.53.53 0 0 1-.771.56l-4.618-2.428a2.122 2.122 0 0 0-1.973 0L6.396 21.01a.53.53 0 0 1-.77-.56l.881-5.139a2.122 2.122 0 0 0-.611-1.879L2.16 9.795a.53.53 0 0 1 .294-.906l5.165-.755a2.122 2.122 0 0 0 1.597-1.16z"></path></svg>
                        {% elif strategy.icon == 'globe' %}
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide" style="color: var(--hh-blue-600);"><circle cx="12" cy="12" r="10"></circle><path d="M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20"></path><path d="M2 12h20"></path></svg>
                        {% elif strategy.icon == 'arrow-right-left' %}
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide" style="color: var(--hh-purple-600);"><path d="m16 3 4 4-4 4"></path><path d="M20 7H4"></path><path d="m8 21-4-4 4-4"></path><path d="M4 17h16"></path></svg>
                        {% else %}
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide" style="color: var(--hh-slate-600);"><rect width="20" height="14" x="2" y="5" rx="2"></rect><line x1="2" x2="22" y1="10" y2="10"></line></svg>
                        {% endif %}
                    </div>
                    
                    <div class="hh-flex-1">
                        <div class="hh-flex hh-justify-between hh-items-start hh-md-block">
                             <div class="hh-font-bold hh-text-sm hh-text-slate-900">{{ strategy.label }}</div>
                             <!-- Mobile Verdict Badge -->
                             <div class="hh-md-hidden">
                                {% if strategy.is_winner %}
                                <span class="hh-badge hh-badge-green">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M20 6 9 17l-5-5"></path></svg> Winner
                                </span>
                                {% elif strategy.verdict == 'Poor Value' %}
                                <span class="hh-badge hh-badge-red">Poor Value</span>
                                {% elif strategy.verdict == 'Good Value' %}
                                <span class="hh-badge hh-badge-green" style="background-color: var(--hh-blue-100); color: var(--hh-blue-700);">Good</span>
                                {% else %}
                                <span class="hh-badge hh-badge-neutral">Neutral</span>
                                {% endif %}
                             </div>
                        </div>
                        
                        <div class="hh-text-xs hh-text-slate-500">{{ strategy.sub_label }}</div>
                        {% if strategy.card_name %}
                        <div class="hh-tag">
                            <svg xmlns="http://www.w3.org/2000/svg" width="10" height="10" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M19 7V4a1 1 0 0 0-1-1H5a2 2 0 0 0 0 4h15a1 1 0 0 1 1 1v4h-3a2 2 0 0 0 0 4h3a1 1 0 0 0 1-1v-2a1 1 0 0 0-1-1"></path><path d="M3 5v14a2 2 0 0 0 2 2h15a1 1 0 0 0 1-1v-4"></path></svg>
                            {{ strategy.card_name }}
                        </div>
                        {% endif %}
                    </div>
                </div>

                <!-- Data Section (Mobile: Middle/Bottom, Desktop: Middle Cols) -->
                <div class="hh-flex-1 hh-flex hh-flex-col hh-gap-2 hh-w-full hh-md-contents">
                     <!-- Costs Row -->
                     <div class="hh-flex hh-justify-between hh-items-end hh-md-contents" style="padding-left: 2rem; margin-top: 0.5rem;"> 
                         <!-- Add padding-left on mobile to align with text, reset on desktop via contents -->
                         
                         <!-- Upfront -->
                         <div class="hh-md-w-1-4 hh-md-text-right">
                             <div class="hh-mobile-label hh-md-hidden">Upfront</div>
                             <div class="hh-font-medium hh-text-sm hh-text-slate-700" style="font-family: monospace;">{{ strategy.cost_display }}</div>
                             {% if strategy.cost_cpp_display %}
                             <div class="hh-text-xs hh-text-slate-400">{{ strategy.cost_cpp_display }}</div>
                             {% endif %}
                         </div>
                         
                         <!-- Effective -->
                         <div class="hh-md-w-1-4 hh-md-text-right" style="text-align: right;">
                             <div class="hh-mobile-label hh-md-hidden">Effective Cost</div>
                             <div class="hh-font-bold hh-text-sm {% if strategy.is_bad_value %}hh-text-red-500{% else %}hh-text-slate-900{% endif %}" style="font-family: monospace;">
                                ${{ strategy.effective_cost|floatformat:0 }}
                             </div>
                             <div class="hh-text-xs hh-text-slate-500 hh-hidden hh-md-block hh-truncate" style="padding-left: 1rem;">
                                {{ strategy.details_earned }}
                             </div>
                         </div>
                     </div>
                     
                     <!-- Mobile Notes (Full Width Box) -->
                     <div class="hh-mobile-notes hh-md-hidden" style="margin-left: 2rem;">
                        {{ strategy.details_earned }}
                     </div>
                </div>

                <!-- Desktop Verdict (Hidden on Mobile) -->
                <div class="hh-col-verdict hh-md-w-1-6 hh-hidden hh-md-flex">
                    {% if strategy.is_winner %}
                    <span class="hh-badge hh-badge-green">
                        <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M20 6 9 17l-5-5"></path></svg>
                        Winner
                    </span>
                    {% elif strategy.verdict == 'Poor Value' %}
                    <span class="hh-badge hh-badge-red">
                        <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-circle-alert"><circle cx="12" cy="12" r="10"></circle><line x1="12" x2="12" y1="8" y2="12"></line><line x1="12" x2="12.01" y1="16" y2="16"></line></svg>
                        Poor Value
                    </span>
                    {% elif strategy.verdict == 'Good Value' %}
                    <span class="hh-badge hh-badge-green" style="background-color: var(--hh-blue-100); color: var(--hh-blue-700);">
                       Good
                    </span>
                    {% else %}
                    <span class="hh-badge hh-badge-neutral">Neutral</span>
                    {% endif %}
                </div>
            </div>
        </div>
        {% endfor %}
    </div>
</div>
